#!/bin/bash

BASH_NO=no . /etc/profile

DIR="/Applications/MailMate.app/Contents/SharedSupport/bin"

if [ ! -f "${DIR}/html2text-orig.py" ]; then
  mv "${DIR}/html2text.py" "${DIR}/html2text-orig.py"
fi

if [ ! -f "${DIR}/html2text.py" ]; then
  touch "${DIR}/html2text.py"
  cat <<EOT >> "${DIR}/html2text.py"
#!/bin/bash

BASH_NO=no . /etc/profile
TMPFILE=\$(mktemp -t html2text_data) || exit 1
cat | perl -pe 's,</?o:[^>]*>,,g' >\${TMPFILE}

cat \${TMPFILE} | tidy -quiet yes -bare -clean -wrap 0 -utf8 --force-output 1 --show-warnings no | html2text --body-width=0 --dash-unordered-list --images-with-size --protect-links --reference-links --no-wrap-links
EOT
  chmod +x "${DIR}/html2text.py"
fi

if [ ! -f "${DIR}/smartypants-orig" ]; then
  mv "${DIR}/smartypants" "${DIR}/smartypants-orig"
  ln -s "/usr/local/bin/smartypants" "${DIR}/smartypants"
fi

if [ ! -f "${DIR}/tnef-orig" ]; then
  mv "${DIR}/tnef" "${DIR}/tnef-orig"
  ln -s "/usr/local/bin/tnef" "${DIR}/tnef"
fi
