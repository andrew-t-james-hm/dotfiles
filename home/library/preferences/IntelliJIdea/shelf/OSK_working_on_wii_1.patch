Index: ../../WebEng/monthly/javaweb/public_html/WEB-INF/tiles/templates/nrd/nrdpage.jsp
===================================================================
--- ../../WebEng/monthly/javaweb/public_html/WEB-INF/tiles/templates/nrd/nrdpage.jsp	(revision 37)
+++ ../../WebEng/monthly/javaweb/public_html/WEB-INF/tiles/templates/nrd/nrdpage.jsp	(revision )
@@ -25,7 +25,7 @@
 %>
 
 <%
-   DeviceIdentityModel deviceModel  =  DeviceIdentityModelFactory.get(request);
+    DeviceIdentityModel deviceModel  =  DeviceIdentityModelFactory.get(request);
    boolean isDebugMode = (deviceModel != null) && deviceModel.debugModeEnabled(request);
   //  NRDRequestContextModel requestModel  = NetflixActionUtils.findOnValueStack( NRDRequestContextModel.class );
 %>
@@ -117,35 +117,418 @@
   </header>
 
   <div class="main-content clearfix">
-    <tiles:insertAttribute name="body" />
+    <tiles:insertAttribute name="body"/>
   </div>
 
-
-  <div id="osk-container" class="oskLayer">
+  <div id="osk-container" class="oskLayer" style="display:none;">
-      <header id="osk-header">
+    <header id="osk-header">
-            <h3><span id="osk-title"></span><a href="#" class="navigatable" id="osk-close-top"><img title="Close" src="http://lgmd-mpetcu.netflix.com:8080/layout/ecom/wii/osk-close.png" /></a></h3>
+      <h3><span id="osk-title"></span></h3>
+      <button type="button" name="osk-close-top" class="navigatable">
+        <img title="Close" src="http://lgmd-mpetcu.netflix.com:8080/layout/ecom/wii/osk-close.png" alt="X" />
+      </button>
+      
-            <input id="osk-input-text" tabindex="100" type="text" value="" class="databegin" />
+      <input id="osk-input-text" tabindex="100" type="text" value="" class="databegin"/>
-            <div id="osk-expiration-text"><input id="osk-input-month" tabindex="101" type="text" value="" /><input tabindex="102" id="osk-input-year" type="text" value="" /></div>
+      <div id="osk-expiration-text">
+        <input id="osk-input-month" tabindex="101" type="text" value=""/>
+        <input tabindex="102" id="osk-input-year" type="text" value=""/>
+      </div>
-      </header>
+    </header>
-      <div id="osk-keys-container" >
-          <div class="osk">
+    
+    
+    <div class="osk-keys-container">
+      <!-- This doesn't work in FF because it thinks the CSS Containing Block of a .osk-cell is the .osk-row, not the .osk -->
-              <div class="osk-cell-highlight" id="osk-cell-highlight" >&nbsp;</div>
+      <div class="osk-cell-highlight" id="osk-cell-highlight">&nbsp;</div>
-              <div id="osk-view-a" class="osk-view"></div>
-              <div id="osk-view-b" class="osk-view"></div>
-              <div id="osk-view-c" class="osk-view"></div>
-              <div id="osk-view-d" class="osk-view"></div>
-              <div id="osk-view-e" class="osk-view"></div>
+
+      <div id="osk-view-a" class="osk-view" style="display:none;">
+        <div class="osk-row">
+          <div id="key000" class="osk-cell">
+            <p><span></span></p>
           </div>
+
+          <div id="key001" class="osk-cell">
+            <p><span></span></p>
-      </div>
+          </div>
+
+          <div id="key002" class="osk-cell">
+            <p><span></span></p>
+          </div>
+
+          <div id="key003" class="osk-cell">
+            <p><span></span></p>
+          </div>
+
+          <div id="key004" class="osk-cell">
+            <p><span></span></p>
+          </div>
+
+          <div id="key005" class="osk-cell">
+            <p><span></span></p>
+          </div>
+
+          <div id="key006" class="osk-cell">
+            <p><span></span></p>
+          </div>
+
+          <div id="key007" class="osk-cell">
+            <p><span></span></p>
+          </div>
+
+          <div id="key008" class="osk-cell">
+            <p><span></span></p>
+          </div>
+
+          <div id="key009" class="osk-cell">
+            <p><span></span></p>
+          </div>
+        </div>
+        <div class="osk-row">
+          <div id="key010" class="osk-cell">
+            <p><span></span></p>
+          </div>
+
+          <div id="key011" class="osk-cell">
+            <p><span></span></p>
+          </div>
+
+          <div id="key012" class="osk-cell">
+            <p><span></span></p>
+          </div>
+
+          <div id="key013" class="osk-cell">
+            <p><span></span></p>
+          </div>
+
+          <div id="key014" class="osk-cell">
+            <p><span></span></p>
+          </div>
+
+          <div id="key015" class="osk-cell">
+            <p><span></span></p>
+          </div>
+
+          <div id="key016" class="osk-cell">
+            <p><span></span></p>
+          </div>
+
+          <div id="key017" class="osk-cell">
+            <p><span></span></p>
+          </div>
+
+          <div id="key018" class="osk-cell">
+            <p><span></span></p>
+          </div>
+
+          <div id="key019" class="osk-cell">
+            <p><span></span></p>
+          </div>
+        </div>
+        <div class="osk-row">
+          <div id="key020" class="osk-cell">
+            <p><span></span></p>
+          </div>
+
+          <div id="key021" class="osk-cell">
+            <p><span></span></p>
+          </div>
+
+          <div id="key022" class="osk-cell">
+            <p><span></span></p>
+          </div>
+
+          <div id="key023" class="osk-cell">
+            <p><span></span></p>
+          </div>
+
+          <div id="key024" class="osk-cell">
+            <p><span></span></p>
+          </div>
+
+          <div id="key025" class="osk-cell">
+            <p><span></span></p>
+          </div>
+
+          <div id="key026" class="osk-cell">
+            <p><span></span></p>
+          </div>
+
+          <div id="key027" class="osk-cell">
+            <p><span></span></p>
+          </div>
+
+          <div id="key028" class="osk-cell">
+            <p><span></span></p>
+          </div>
+
+          <div id="key029" class="osk-cell">
+            <p><span></span></p>
+          </div>
+        </div>
+        <div class="osk-row">
+          <div id="key030" class="osk-cell double">
+            <p><span></span></p>
+          </div>
+
+          <div id="key031" class="osk-cell">
+            <p><span></span></p>
+          </div>
+
+          <div id="key032" class="osk-cell">
+            <p><span></span></p>
+          </div>
+
+          <div id="key033" class="osk-cell">
+            <p><span></span></p>
+          </div>
+
+          <div id="key034" class="osk-cell">
+            <p><span></span></p>
+          </div>
+
+          <div id="key035" class="osk-cell">
+            <p><span></span></p>
+          </div>
+
+          <div id="key036" class="osk-cell">
+            <p><span></span></p>
+          </div>
+
+          <div id="key037" class="osk-cell">
+            <p><span></span></p>
+          </div>
+
+          <div id="key038" class="osk-cell">
+            <p><span></span></p>
+          </div>
+        </div>
+        <div class="osk-row">
+          <div id="key039" class="osk-cell double">
+            <p><span></span></p>
+          </div>
+
+          <div id="key040" class="osk-cell">
+            <p><span></span></p>
+          </div>
+    
+          <div id="key041" class="osk-cell">
+            <p><span></span></p>
+          </div>  
+
+          <div id="key042" class="osk-cell double">
+            <p><span></span></p>
+          </div>
+
+          <div id="key043" class="osk-cell">
+            <p><span></span></p>
+          </div>
+
+          <div id="key044" class="osk-cell">
+            <p><span></span></p>
+          </div>
+
+          <div id="key045" class="osk-cell double">
+            <p><span></span></p>
+          </div>
+        </div>
+      </div>
+      <div id="osk-view-b" class="osk-view" style="display:none;">
+        <div class="osk-row">
+          <div id="key100" class="osk-cell">
+            <p><span></span></p>
+          </div>
+
+          <div id="key101" class="osk-cell">
+            <p><span></span></p>
+          </div>
+
+          <div id="key102" class="osk-cell">
+            <p><span></span></p>
+          </div>
+
+          <div id="key103" class="osk-cell">
+            <p><span></span></p>
+          </div>
+
+          <div id="key104" class="osk-cell">
+            <p><span></span></p>
+          </div>
+
+          <div id="key105" class="osk-cell">
+            <p><span></span></p>
+          </div>
+
+          <div id="key106" class="osk-cell">
+            <p><span></span></p>
+          </div>
+
+          <div id="key107" class="osk-cell">
+            <p><span></span></p>
+          </div>
+
+          <div id="key108" class="osk-cell">
+            <p><span></span></p>
+          </div>
+
+          <div id="key109" class="osk-cell">
+            <p><span></span></p>
+          </div>
+        </div>
+        <div class="osk-row">
+          <div id="key110" class="osk-cell">
+            <p><span></span></p>
+          </div>
+
+          <div id="key111" class="osk-cell">
+            <p><span></span></p>
+          </div>
+
+          <div id="key112" class="osk-cell">
+            <p><span></span></p>
+          </div>
+
+          <div id="key113" class="osk-cell">
+            <p><span></span></p>
+          </div>
+
+          <div id="key114" class="osk-cell">
+            <p><span></span></p>
+          </div>
+
+          <div id="key115" class="osk-cell">
+            <p><span></span></p>
+          </div>
+
+          <div id="key116" class="osk-cell">
+            <p><span></span></p>
+          </div>
+
+          <div id="key117" class="osk-cell">
+            <p><span></span></p>
+          </div>
+
+          <div id="key118" class="osk-cell">
+            <p><span></span></p>
+          </div>
+
+          <div id="key119" class="osk-cell">
+            <p><span></span></p>
+          </div>
+        </div>
+        <div class="osk-row">
+          <div id="key120" class="osk-cell">
+            <p><span></span></p>
+          </div>
+
+          <div id="key121" class="osk-cell">
+            <p><span></span></p>
+          </div>
+
+          <div id="key122" class="osk-cell">
+            <p><span></span></p>
+          </div>
+
+          <div id="key123" class="osk-cell">
+            <p><span></span></p>
+          </div>
+
+          <div id="key124" class="osk-cell">
+            <p><span></span></p>
+          </div>
+
+          <div id="key125" class="osk-cell">
+            <p><span></span></p>
+          </div>
+
+          <div id="key126" class="osk-cell">
+            <p><span></span></p>
+          </div>
+
+          <div id="key127" class="osk-cell">
+            <p><span></span></p>
+          </div>
+
+          <div id="key128" class="osk-cell">
+            <p><span></span></p>
+          </div>
+
+          <div id="key129" class="osk-cell">
+            <p><span></span></p>
+          </div>
+        </div>
+        <div class="osk-row">
+          <div id="key130" class="osk-cell double">
+            <p><span></span></p>
+          </div>
+
+          <div id="key131" class="osk-cell">
+            <p><span></span></p>
+          </div>
+
+          <div id="key132" class="osk-cell">
+            <p><span></span></p>
+          </div>
+
+          <div id="key133" class="osk-cell">
+            <p><span></span></p>
+          </div>
+
+          <div id="key134" class="osk-cell">
+            <p><span></span></p>
+          </div>
+
+          <div id="key135" class="osk-cell">
+            <p><span></span></p>
+          </div>
+
+          <div id="key136" class="osk-cell">
+            <p><span></span></p>
+          </div>
+
+          <div id="key137" class="osk-cell">
+            <p><span></span></p>
+          </div>
+
+          <div id="key138" class="osk-cell">
+            <p><span></span></p>
+          </div>
+        </div>
+        <div class="osk-row">
+          <div id="key139" class="osk-cell double">
+            <p><span></span></p>
+          </div>
+
+          <div id="key140" class="osk-cell double">
+            <p><span></span></p>
+          </div> 
+
+          <div id="key141" class="osk-cell double">
+            <p><span></span></p>
+          </div>
+
+          <div id="key142" class="osk-cell">
+            <p><span></span></p>
+          </div>
+
+          <div id="key143" class="osk-cell">
+            <p><span></span></p>
+          </div>
+
+          <div id="key144" class="osk-cell double">
+            <p><span></span></p>
+          </div>
+        </div>
+      </div>
+  
+    </div>    
+    
-       <footer id="osk-footer">
-          <div class="wii-buttons">
+    <footer id="osk-footer">
+      <div class="wii-buttons">
-            <button tabindex="80" data-type="button" tabindex="103" id="osk-close" ><span class="button_outer"><s2:text name="msg-osk-button-close"/></span></button>
-            <button tabindex="81" data-type="button" tabindex="104" id="osk-enter" class="dataend" ><span class="button_outer"><s2:text name="msg-osk-button-enter"/></span></button>
+        <button tabindex="80" type="button" tabindex="103" name="osk-close" id="osk-close"><span class="button_outer"><s2:text name="msg-osk-button-close"/></span></button>
+        <button tabindex="81" type="button" tabindex="104" name="osk-enter" id="osk-enter" class="dataend"><span class="button_outer"><s2:text name="msg-osk-button-enter"/></span></button>
-          </div>
-      </footer>
+      </div>
+    </footer>
+    
   </div>
 
-
   <footer class="main">
     <%if (WebServerProperties.isServerTestOrDev()) {%>
     <span class="serverid"><%=Customer.getCustomer(request).getCustomerID()%>&nbsp;<%=Customer.getCustomer(request).getPromotion().getPromotionIDChar()%>&nbsp; <% if ( tvTest3.customersCurrentCell() > 0) { %><%=String.valueOf(tvTest3.getTestID())+"~"+tvTest3.customersCurrentCell()%><% } else { %>Not in TV3 Test<% } %> &nbsp; <% if ( tvTest4.customersCurrentCell() > 0) { %><%=String.valueOf(tvTest4.getTestID())+"~"+tvTest4.customersCurrentCell()%><% } else { %>Not in TV4 Test<% } %> &nbsp; <%= ServerIdString.getString()%>&nbsp;<%=Countries.getCountryCode(WebServerProperties.getCountryID())%></span>
@@ -154,20 +537,28 @@
     <% JavascriptClass jsModule = JavascriptClass.getJavascriptPackage(pageName);
     if ( jsModule == null ) jsModule = JavascriptClass.getJavascriptPackage(fallbackModuleName); %>
     <%= jsModule != null ? jsModule.toHtml(request) : "" %>
-    <% if ( !NRDAppUtils.useNativeOSK() ) { %>
-    <netflix:collectscript>
-    osk.disableNative();
-    </netflix:collectscript>
-    <% } %>
 
-    <netflix:collectscript>
+    <netflix:collectscript>      
+    var that = this;
+    var refreshBound = function() { return beginrefresh.apply(that, arguments); };
+    
-    netflix.NRDUtil.DomUtil.domReady( function() {
+    netflix.NRDUtil.DomUtil.domReady(function() {
-        osk.setCenterOnScreen(true);
-        osk.setAutoUpdateTrigger(false);
+      if(window.nrdp) refreshBound();
-    } );
+    });
-    </netflix:collectscript>
-
+    
+    var parselimit=5;
+    var beginrefresh = function() {
+    	if (parselimit == 1) {
+      	window.location.reload()
+    	} else {
+    		parselimit -= 1;
+    		setTimeout(refreshBound, 1000);
+    	}
+    }
+    
+    </netflix:collectscript>
     <netflix:emitcollectedscripts/>
+
   </footer>
 
 
Index: ../../WebEng/monthly/javaweb/public_html/layout/jscript_src/nrd_osk_controller.js
===================================================================
--- ../../WebEng/monthly/javaweb/public_html/layout/jscript_src/nrd_osk_controller.js	(revision 5)
+++ ../../WebEng/monthly/javaweb/public_html/layout/jscript_src/nrd_osk_controller.js	(revision )
@@ -1,7 +1,7 @@
 (function(window, document, N, undefined) {  
     var slice = Array.prototype.slice;
         
-    var notifyHelper = function() {	
+    var notifyHelper = function() { 
       var args = slice.call(arguments),
         obj, evtName, optEvtName;
     
@@ -19,74 +19,7 @@
         return obj.notify.apply(obj, args.concat( slice.call(arguments) ));
       };
     };
-      
+            
-    function offsetAndRect( elem ) {
-  		if ( !elem || !elem.ownerDocument ) {
-  			return null;
-  		}
-
-  		try {
-  			var box = elem.getBoundingClientRect();
-  		} catch(e) {}
-
-  		var doc = elem.ownerDocument,
-  			docElem = doc.documentElement;
-
-  		// Make sure we're not dealing with a disconnected DOM node
-//  		if ( !box || !docElem.contains(elem) ) {
-//  			return box ? { top: box.top, left: box.left, width: box.width, height: box.height } : 
-//  			  { top: 0, left: 0, width: 0, height: 0 };
-//  		}
-
-  		var body = doc.body,
-  			win = getWindow(doc),
-  			clientTop  = docElem.clientTop  || body.clientTop  || 0,
-  			clientLeft = docElem.clientLeft || body.clientLeft || 0,
-  			scrollTop  = (win.pageYOffset || docElem.scrollTop  || body.scrollTop ),
-  			scrollLeft = (win.pageXOffset || docElem.scrollLeft || body.scrollLeft),
-  			top  = box.top  + scrollTop  - clientTop,
-  			left = box.left + scrollLeft - clientLeft;
-
-  		return { top: top, left: left, width: box.width, height: box.height };
-  	};
-
-  	function getWindow( elem ) {
-    	return elem.nodeType === 9 ?
-    		elem.defaultView || elem.parentWindow :
-    		false;
-    }
-  
-  	function getOffsetParent( elem ) {
-  	  /* returns the positioning container of the element. Every positioned element 
-  	   * (be it relative or absolute positioning) has a positioning container, which 
-  	   * is defined by a nontrivial set of rules in the CSS specification, 
-  	   * as the 'CSS-containing block.' 
-  	   */
-  	  if ( !elem || !elem.ownerDocument ) {
-  			return null;
-  		}
-
-			if (elem.offsetParent) {
-			  return elem.offsetParent;
-			}
-			
-			var doc = elem.ownerDocument,
-  			docElem = doc.documentElement,
-  			body = doc.body,
-  			win = getWindow(doc);
-  			
-			if (elem === body) {
-			  return elem;
-			}
-
-			while ((elem = elem.parentNode) && elem !== body) {
-				if (win.getComputedStyle(elem, null)['position'] !== 'static') {
-					return elem;
-				}
-			}
-			return body;
-		};
-      
     var View = {
       value:function(options){
         return new View.value.fn.initialize(options);
@@ -99,6 +32,7 @@
         return this;
       },
       get:function(oskId){
+        // TODO: Reduce this to just a DIV
         var eleKeys = N("#" + oskId + " p span"),
           values = [];
         for(var i = 0, l = eleKeys.length; i < l; i++) {
@@ -106,6 +40,7 @@
         }
       },
       set:function(oskId, newVal){
+        // TODO: Reduce this to just a DIV
         var eleKeys = N("#" + oskId + " p span");
         for(var i = 0, l = eleKeys.length; i < l; i++) {
           eleKeys[i].innerHTML = newVal;
@@ -130,7 +65,51 @@
             
           cssStyle['display'] = "block";
         }
+      },
+      genMarkupHelper: function (options, opts) {
+        var className = "osk-cell";
+        opts.className =  opts.className || '';
+        opts.id = opts.id || 0;
+      
+        var id = options.model_key_default_key.substr(0,4) + opts.id;
+        if( opts.id < 10) 
+          id = options.model_key_default_key.substr(0,5) + opts.id;
+        if( opts.className !== 'single') 
+          className += " " + opts.className;
+      
+        var markup = "<div id=\"" + id + "\" class=\"" + className + "\">";
+        // TODO: Reduce this to just a DIV
+        markup +="<p><span>&nbsp;</span></p></div>";
+        if( opts.className === 'space') {
+          markup = "<div class=\"space\">";
+          markup +="<p><span>&nbsp;</span></p></div>";
-      }
+        }
+        return markup;
+      },
+      genMarkup: function(options) {
+        var els = N(options.view_selector) || [],
+          tmpls = options.osk_template || [];
+          
+        for(var i = 0, l = els.length; i < l; i++){
+          var el = els[i],
+            html = "",
+            id = 0;
+          
+          for( var j = 0, k = tmpls.length; j < k; j++) {
+            html += "<div class=\"osk-row\">";
+            var row = tmpls[j];
+            
+            for(var m = 0, n = row.cells.length; m < n; m++ ){
+              html += this.genMarkupHelper( options, {'className':row.cells[m], 'id':id});
+              id++;
+            }
+            
+            html += "</div>";
+          }
+          
+          el.innerHTML = html;
+        }
+      }
     };
     View.value.fn.initialize.prototype = View.value.fn; 
      
@@ -151,6 +130,9 @@
         options.osk_highlight_selector = options.osk_highlight_selector || '#osk-cell-highlight';
         options.osk_cell_selector = options.osk_cell_selector || '.osk-cell';
         options.osk_view_selector = options.view_selector;
+        var defaultStyle = {"top": 1, "left": 1, "width": 2, "height":2};
+        options.osk_highlight_style = N.extend(defaultStyle, options.osk_highlight_style || {});
+        
         this.my_state = {};
         var modelKeys = this.my_state["model_keys"] = options.model_keys || {};
         this.my_state["model_navigation"] = options.model_navigation || {};
@@ -159,18 +141,18 @@
         this.my_state["super_controller"] = options.super_controller || {};
         this.my_state["options"] = options;
         this.my_state["view_value"] = View.value(options);
-        this.my_state["view_template"] = options.osk_template || {};
-        this.my_state["view_selector"] = options.osk_view_selector || '';
-
+        
-        
         N.extend(F.prototype, N.PubSub.prototype);
         
         this.setMouseOverOsk(null);
         this.setMouseOutOsk(null);
-       
+ 
         this.wireUpEvents();
       
-        this.get_view_html(options.osk_template);
+        // uncomment this line to generate the html
+        // var valueView = this.getValueView();
+        // valueView.genMarkup(options);
+        
         this.initKeys(options);   
         this.initModelKeysAndState(modelKeys, options);  
         
@@ -180,16 +162,16 @@
       },
       wireUpEvents:function() {
         var clickHandler = N.bind( this.clickHandler, this );
-        this.observe('click', clickHandler);
+        this.observe('key-click', clickHandler);
 
         var keyDownHandler = N.bind( this.keyDownHandler, this );
-        this.observe('keydown', keyDownHandler);
+        this.observe('key-down', keyDownHandler);
 
         var mouseOverHandler = N.bind( this.mouseOverHandler, this );
-        this.observe('mouseover', mouseOverHandler);
+        this.observe('mouse-over', mouseOverHandler);
 
         var mouseOutHandler = N.bind( this.mouseOutHandler, this );
-        this.observe('mouseout', mouseOutHandler);
+        this.observe('mouse-out', mouseOutHandler);
         
         // Handle the shift event
         var shiftHandler = N.bind( this.shiftHandler, this );
@@ -198,15 +180,11 @@
         // Handle the swapping event
         var swapHandler = N.bind( this.swapHandler, this );
         this.observe("swap", swapHandler);
+        
+        // Move the caret event
+        var caretHandler = N.bind( this.caretHandler, this );
+        this.observe("caret", caretHandler);
       },
-      showController: function() {
-        var element = document.querySelector(this.my_state["view_selector"]);
-        if( element) element.style.display = "block";
-      } ,
-      hideController:function() {
-        var element = document.querySelector(this.my_state["view_selector"]);
-        if( element) element.style.display = "none";
-      },
       initKeys:function(options){
         // method 1. Go through each key, get all of its descendants,
         // and say they're associated with their parent.
@@ -242,8 +220,8 @@
             children = oskKey && oskKey.getElementsByTagName('*') || [];
             
           if(!offsetParent) {
-            offsetParent = getOffsetParent(oskKey); /* should be the same for all the keys */
-            offsetParentRect = offsetAndRect(offsetParent);
+            offsetParent = N.getOffsetParent(oskKey); /* should be the same for all the keys */
+            offsetParentRect = N.offsetAndRect(offsetParent);
           }
          
           for(var j = 0, k = children.length; j < k; j++) {
@@ -254,7 +232,7 @@
           
           if(!lazyInitRect) {
             var data = navigation[masterId],
-              offsetRect = offsetAndRect(oskKey);
+              offsetRect = N.offsetAndRect(oskKey);
             offsetRect.top -= offsetParentRect.top;
             offsetRect.left -= offsetParentRect.left;
             if(!data){
@@ -265,40 +243,6 @@
           }
         }
       },
-      generate_html_simple: function (options) {
-        var className = "osk-cell ";
-        options.className =  options.className || '';
-        options.id = options.id || 0;
-
-        var id = this.my_state["options"].model_key_default_key.substr(0,4) + options.id;
-        if( options.id < 10) id = this.my_state["options"].model_key_default_key.substr(0,5) + options.id;
-        if( options.className !== 'single') className += options.className;
-
-        var markup = "<div id=\"" + id + "\" class=\"" + className + "\">";
-        markup +="<p><span>&nbsp;</span></p></div>";
-        if( options.className === 'space') {
-            markup = "<div class=\"space\">";
-            markup +="<p><span>&nbsp;</span></p></div>";
-        }
-        return markup;
-      },
-
-      get_view_html: function(array) {
-        var element = document.querySelector(this.my_state["view_selector"]);
-        if( !element ) return;
-        var html = "";
-        var id = 0;
-        for( var i=0, len= array.length; i<len; i++) {
-          html += "<div class=\"osk-row\">";
-          for(var j=0, cols = array[i].cells.length; j < cols; j++ ){
-            html += this.generate_html_simple( { 'className' : array[i].cells[j], 'id':id  });
-            id++;
-          }
-          html += "</div>";
-        }
-        element.innerHTML = html;
-      },
-
       initModelKeysAndState:function(modelKeys, options){
         // build our available names
         var modelKeyNames = [];
@@ -366,7 +310,6 @@
           for(name in currentKeys) possibleKeyNames.push(name);
           if(possibleKeyNames) {
             var keyId = possibleKeyNames[0];
-            //this.enteringOskKey(keyId);
             options["model_key_default_key"] = keyId;
           } else {
             console.info("No keys found, can't set default key.");
@@ -404,7 +347,7 @@
         if(keyMapping) {
           if(keyMapping["char"]) {
             // Publish the character code
-            this.getSuperController().notify("keypress", keyMapping["char"]);
+            this.getSuperController().notify("key-press", keyMapping["char"]);
             
             if(this.getPopBackFlag()) {
               this.setPopBackFlag(null);
@@ -424,7 +367,7 @@
       clickHandler: function(evtName, e) {
         this.doKeysAction(this.getCurrentOskKeyId());
       },
-      keyDownHandler:function(evtName, e) {           
+      keyDownHandler:function(evtName, e) {         
         var keyCodes = this.getModelKeyCodes(),
           keycode = keyCodes["" + e.keyCode],
           currentOsk = this.getCurrentOskKeyId(),
@@ -432,7 +375,7 @@
           navigable = navigationModel[currentOsk] || {},
           goingTo;
         
-        if(!currentOsk) return;/* is there even a current osk key? */
+        if(!currentOsk) return false; /* is there even a current osk key? */
         
         var goToKey = N.bind(function(currentOskId, goingToOskId) {
           if(currentOskId && goingToOskId) {
@@ -440,40 +383,37 @@
             this.enteringOskKey(goingToOskId, navigationModel[goingToOskId]);
           }
         }, this);
-          
+                  
         var whatStep = {
-          "KEY_ENTER" : function() {
+          "key.enter" : function() {
             this.doKeysAction(currentOsk);
           },
-          "KEY_ESCAPE" : function() {
-            // publis Escape Key
-            this.getSuperController().notify("key-escape", oskId);
-          },
-          "KEY_UP" : function() {
+          "key.up" : function() {
             goingTo = navigable["top"];
             goToKey(currentOsk, goingTo);
-            if( goingTo == this.my_state["options"].model_key_default_key)  {
-              this.getSuperController().notify("leave-top");
-            }
           },
-          "KEY_RIGHT" : function() {
+          "key.right" : function() {
             goingTo = navigable["right"];
             goToKey(currentOsk, goingTo);
           },
-          "KEY_DOWN" : function() {
+          "key.down" : function() {
             goingTo = navigable["bottom"];
             goToKey(currentOsk, goingTo);
           },
-          "KEY_LEFT" : function() {
+          "key.left" : function() {
             goingTo = navigable["left"];
             goToKey(currentOsk, goingTo);
           },
-          "KEY_NOOP" : function() {}
+          "no.op" : function() { return false;}
         };
 
-        var fn = whatStep[keycode] || whatStep["KEY_NOOP"];
+        var fn = whatStep[keycode] || whatStep["no.op"];
         fn.apply(this);
+        return true;
       },
+      caretHandler:function(evtName, direction){
+        this.getSuperController().notify("caret-move", direction);
+      },
       swapHandler:function(evtName, stateName) {
         var modelKeys = this.getModelKeys(),
           nci = this.getCurrentStateNameCaseIndex(),
@@ -570,18 +510,12 @@
         }
       },
       setKeysFromModel:function(keys, clearEmpty){
-        // TODO: Get rid of this dynamic regex with a static one?
-        // or better yet, get rid of the need for it from the model above.
         var valueView = this.getValueView(),
           newVal, name, oskKey;
  
         for(name in keys) {
-          newVal =   keys[name]["char"] || '';
+          newVal = keys[name]["char"];
           newVal = keys[name]["display"] || newVal;
-          
-          if(newVal.match(/^\\u/))
-            newVal = newVal.replace(/\\u/g, "&#x") + ";";
-             
           valueView.set(name, newVal);
         }
         
@@ -613,14 +547,14 @@
         this.isEnteringOskKey();
       },
       mouseOutHandler: function(evtName, e){
-        
         var ele = document.elementFromPoint(e.clientX, e.clientY),
           settings = ele ? N.expando.getDataForElem(ele) || {} : {},
           oskKeyMappings = settings.osk_key_mappings || []; 
-        
+
         for(var i = 0, l = oskKeyMappings.length; i < l; i++) {
-           var id = oskKeyMappings[i]["id"];
+          var id = oskKeyMappings[i]["id"];
         }
+        
         this.setMouseOutOsk(id);
         this.isLeavingOskKey();
       },
@@ -670,6 +604,7 @@
         if(retvals.indexOf(false) >= 0) return; /* a listener cancelled us */
                 
         this.setCurrentOskKeyId(null); /* re-assign the current_osk */
+        this.restoreKeyStyle(oskId);
         
         var options = this.getOptions(),
           oskHighlightSelector = options.osk_highlight_selector,
@@ -678,8 +613,7 @@
         for(var i = 0, l = eleOskHighlights.length; i < l; i++) {
           var eleOskHighlight = eleOskHighlights[i] || {},  
             cssStyle = eleOskHighlight['style'] || {};
-            //cssStyle['visibility'] = "hidden";
-            //cssStyle['display'] = "none";
+            cssStyle['visibility'] = "hidden";
         }
       },
       enteringOskKey:function(oskId, enteringKeyNavigationModel){
@@ -687,16 +621,18 @@
         var retvals = this.getSuperController().notify("key-entering", oskId, enteringKeyNavigationModel);
         if(retvals.indexOf(false) >= 0) return; /* a listener cancelled us */
         
+        this.restoreKeyStyle(this.getCurrentOskKeyId());
+        
         this.setCurrentOskKeyId(oskId); /* re-assign the current_osk */
         
         var options = this.getOptions(),
+          defStyle = options["osk_highlight_style"],
           oskHighlightSelector = options.osk_highlight_selector,
           eleOskHighlights = N(oskHighlightSelector) || [],
           offsetRect = {};
 
         var getOffsetRect = function(id) {
           var eleOskKey = document.getElementById(id),
-            options = this.getOptions(),
             navigation = this.getModelNavigation(),
             lazyInitRect = options.lazy_init_rect,
             offsetRect, offsetParent, offsetParentRect;
@@ -706,12 +642,9 @@
           // recalculate these values.
           if(lazyInitRect) {
             var data = navigation[id];              
-            offsetParent = getOffsetParent(eleOskKey); /* should be the same for all the keys */
-            //console.log('offset parent:' + offsetParent.className)
-            offsetParentRect = offsetAndRect(offsetParent);
-            //console.log('offset parent rect:' + JSON.stringify(offsetParentRect))
-            offsetRect = offsetAndRect(eleOskKey);
-            //console.log('offset rect:' + JSON.stringify(offsetRect))
+            offsetParent = N.getOffsetParent(eleOskKey); /* should be the same for all the keys */
+            offsetParentRect = N.offsetAndRect(offsetParent);
+            offsetRect = N.offsetAndRect(eleOskKey);
             offsetRect.top -= offsetParentRect.top;
             offsetRect.left -= offsetParentRect.left;
 
@@ -733,14 +666,27 @@
           var eleOskHighlight = eleOskHighlights[i] || {},  
             cssStyle = eleOskHighlight['style'] || {};
             
-          cssStyle['top'] = offsetRect.top + "px";
-          cssStyle['left'] = offsetRect.left + "px";
-          cssStyle['width'] = offsetRect.width + "px";
-          cssStyle['height'] = offsetRect.height + "px";
+          cssStyle['top'] = (offsetRect.top - defStyle.top) + "px";
+          cssStyle['left'] = (offsetRect.left - defStyle.left) + "px";
+          cssStyle['width'] = (offsetRect.width + defStyle.width) + "px";
+          cssStyle['height'] = (offsetRect.height + defStyle.height) + "px";
           cssStyle['visibility'] = "visible";
-          //cssStyle['display'] = "block";
+          
+          var eleOskKey = document.getElementById(oskId);
+          var oskCssStyle = eleOskKey['style'] || {};
+          oskCssStyle['border'] = "none";
+          oskCssStyle['backgroundColor'] = "transparent";
         }
       },
+      restoreKeyStyle:function(id){
+        if(id){
+          var eleOskKey = document.getElementById(id);
+            
+          if(eleOskKey){
+            eleOskKey.setAttribute("style", "");
+          }
+        }
+      },
       hideView:function(){
         var options = this.getOptions(),
           valueView = this.getValueView();
@@ -811,7 +757,6 @@
         return this.my_state["mouse_over_osk"];
       },
       setMouseOverOsk:function(id){
-       
         this.my_state["mouse_over_osk"] = id;
       },
       getOskStateStack:function(){
@@ -858,4 +803,3 @@
     window.notifyHelper = notifyHelper;
     
 })(window, document, N);
-
Index: ../../WebEng/monthly/javaweb/public_html/layout/jscript_src/nrd_osk_alpha_view.js
===================================================================
--- ../../WebEng/monthly/javaweb/public_html/layout/jscript_src/nrd_osk_alpha_view.js	(revision 4)
+++ ../../WebEng/monthly/javaweb/public_html/layout/jscript_src/nrd_osk_alpha_view.js	(revision )
@@ -142,8 +142,8 @@
           }
         },
         "key041": {
-          "dead":true,
-          "display":"`"
+          "char":"\u002e",
+          "display":"n!"
         },
         "key042": {
           "char":"\u0020",
@@ -151,17 +151,22 @@
         },
         "key043": {
           "display":"\u003c",
-          "func": function() { alert("publish(\"go-left\")"); } 
+          "func": function() { 
+            notifyHelper(this, "caret", "go.left").apply(this, arguments);
+          } 
         },
         "key044": {
           "display":"\u003e",
-          "func": function() { alert("publish(\"go-right\")"); } 
+          "func": function() { 
+            notifyHelper(this, "caret", "go.right").apply(this, arguments);
+          } 
         },
         "key045": {
           "display":"\\b",
-          "char":"\u0008",
-          "func":function(){}
+          "func":function(){
+            notifyHelper(this, "caret", "go.backspace").apply(this, arguments);
-        }
+          }
+        }
       },  
       "upper":{
         "key000": {
@@ -297,8 +302,8 @@
           }
         },
         "key041": {
-          "dead":true,
-          "display":"`"
+          "char":"\u002e",
+          "display":"N!"
         },        
         "key042": {
           "char":"\u0020",
@@ -306,18 +311,23 @@
         },
         "key043": {
           "display":"\u003c",
-          "func": function() { alert("publish(\"go-left\")");}
+          "func": function() { 
+            notifyHelper(this, "caret", "go.left").apply(this, arguments);
+          }
         },
         "key044": {
           "display":"\u003e",
-          "func": function() { alert("publish(\"go-right\")"); }
+          "func": function() { 
+            notifyHelper(this, "caret", "go.right").apply(this, arguments);
+          }
         },
         "key045": {
           "display":"\\b",
-          "char":"\u0008",
-          "func": function() {}
+          "func": function() {
+            notifyHelper(this, "caret", "go.backspace").apply(this, arguments);
-        }
-      }
+          }
+        }
+      }
     }] 
   };
   
@@ -463,17 +473,22 @@
         },
         "key142": {
           "display":"\u003c",
-          "func": function() { alert("publish(\"go-left\")"); } 
+          "func": function() { 
+            notifyHelper(this, "caret", "go.left").apply(this, arguments);
+          } 
         },
         "key143": {
           "display":"\u003e",
-          "func": function() { alert("publish(\"go-right\")"); } 
+          "func": function() { 
+            notifyHelper(this, "caret", "go.right").apply(this, arguments);
+          } 
         },
         "key144": {
           "display":"\\b",
-          "char":"\u0008",
-          "func":function(){}
+          "func":function(){
+            notifyHelper(this, "caret", "go.backspace").apply(this, arguments);
-        }
+          }
+        }
       },
       "upper":{
         "key100": {
@@ -614,68 +629,77 @@
         },
         "key142": {
           "display":"\u003c",
-          "func": function() { alert("publish(\"go-left\")");}
+          "func": function() { 
+            notifyHelper(this, "caret", "go.left").apply(this, arguments);
+          }
         },
         "key143": {
           "display":"\u003e",
-          "func": function() { alert("publish(\"go-right\")"); }
+          "func": function() { 
+            notifyHelper(this, "caret", "go.right").apply(this, arguments);
+          }
         },
         "key144": {
           "display":"\\b",
-          "char":"\u0008",
-          "func": function() {}
+          "func": function() {
+            notifyHelper(this, "caret", "go.backspace").apply(this, arguments);
-        }          
-      }
+          }
+        }          
+      }
     }]
   };
 
-  var model_keys_numbers = {
+  var model_keys_numbers = {  
-    
-      "numbers" : [{
-        "key300": {
-          "char":"1"
-        },
-        "key301": {
-          "char":"2"
-        },
-        "key302": {
-          "char":"3"
-        },
-        "key303": {
-          "char":"4"
-        },
-        "key304": {
-          "char":"5"
-        },
-        "key305": {
-          "char":"6"
-        },
-        "key306": {
-          "char":"7"
-        },
-        "key307": {
-          "char":"8"
-        },
-        "key308": {
-          "char":"9"
-        },
-        "key309": {
-          "char":"0"
-        },
-        "key310": {
-          "display":"\u003c",
+    "numbers" : [{
+      "key300": {
+        "char":"1"
+      },
+      "key301": {
+        "char":"2"
+      },
+      "key302": {
+        "char":"3"
+      },
+      "key303": {
+        "char":"4"
+      },
+      "key304": {
+        "char":"5"
+      },
+      "key305": {
+        "char":"6"
+      },
+      "key306": {
+        "char":"7"
+      },
+      "key307": {
+        "char":"8"
+      },
+      "key308": {
+        "char":"9"
+      },
+      "key309": {
+        "char":"0"
+      },
+      "key310": {
+        "display":"\u003c",
-          "func": function() { alert("publish(\"go-left\")"); }
+        "func": function() { 
+          notifyHelper(this, "caret", "go.left").apply(this, arguments);
+        }
-        },
-        "key311": {
-          "display":"\u003e",
+      },
+      "key311": {
+        "display":"\u003e",
-          "func": function() { alert("publish(\"go-right\")"); }
+        "func": function() {  
+          notifyHelper(this, "caret", "go.right").apply(this, arguments);
+        }
-        },
-        "key312": {
-          "display":"\\b",
+      },
+      "key312": {
+        "display":"\\b",
-          "char":"\u0008",
-          "func":function(){}
+        "func":function(){
+          notifyHelper(this, "caret", "go.backspace").apply(this, arguments);
         }
+      }
-      }]
+    }]
   };
 
   var year_expiration = new Date().getFullYear();
@@ -690,7 +714,6 @@
       "key202": {
         "char":"Mar"
       },
-
       "key203": {
         "char": "" + year_expiration++
       },
@@ -752,273 +775,267 @@
         "char": "" + year_expiration++
       },
       "key223": {
-        "char": "" + year_expiration++
+        "char": "" + year_expiration
       }
     }]
   };
 
-
-
-
   var model_navigation_numbers = {
-      "key300": {
-        "top":"key300",
-        "right":"key301",
-        "bottom":"key305",
-        "left":"key300",
-        "is":{
-          "top":true
-        }
-      },
-      "key301": {
-        "top":"key301",
-        "right":"key302",
-        "bottom":"key306",
-        "left":"key300",
-        "is":{
-          "top":true
-        }
-      },
-      "key302": {
-        "top":"key302",
-        "right":"key303",
-        "bottom":"key307",
-        "left":"key301",
-        "is":{
-          "top":true
-        }
-      },
-      "key303": {
-        "top":"key303",
-        "right":"key304",
-        "bottom":"key308",
-        "left":"key302",
-        "is":{
-          "top":true
-        }
-      },
-      "key304": {
-        "top":"key304",
-        "right":"key305",
-        "bottom":"key309",
-        "left":"key303",
-        "is":{
-          "top":true
-        }
-      },
-      "key305": {
-        "top":"key300",
-        "right":"key306",
-        "bottom":"key310",
-        "left":"key304"
-      },
-      "key306": {
-        "top":"key301",
-        "right":"key307",
-        "bottom":"key311",
-        "left":"key305"
-      },
-      "key307": {
-        "top":"key302",
-        "right":"key308",
-        "bottom":"key312",
-        "left":"key306"
-      },
-      "key308": {
-        "top":"key303",
-        "right":"key309",
-        "bottom":"key308",
-        "left":"key307"
-      },
-      "key309": {
-        "top":"key304",
-        "right":"key310",
-        "bottom":"key309",
-        "left":"key308"
-      },
-      "key310": {
-        "top":"key305",
-        "right":"key311",
-        "bottom":"key310",
-        "left":"key309"
-      },
-      "key311": {
-        "top":"key306",
-        "right":"key312",
-        "bottom":"key311",
-        "left":"key310"
-      },
-      "key312": {
-        "top":"key307",
-        "right":"key312",
-        "bottom":"key312",
-        "left":"key311"
-      }
+    "key300": {
+      "top":"key300",
+      "right":"key301",
+      "bottom":"key305",
+      "left":"key300",
+      "is":{
+        "top":true
+      }
+    },
+    "key301": {
+      "top":"key301",
+      "right":"key302",
+      "bottom":"key306",
+      "left":"key300",
+      "is":{
+        "top":true
+      }
+    },
+    "key302": {
+      "top":"key302",
+      "right":"key303",
+      "bottom":"key307",
+      "left":"key301",
+      "is":{
+        "top":true
+      }
+    },
+    "key303": {
+      "top":"key303",
+      "right":"key304",
+      "bottom":"key308",
+      "left":"key302",
+      "is":{
+        "top":true
+      }
+    },
+    "key304": {
+      "top":"key304",
+      "right":"key305",
+      "bottom":"key309",
+      "left":"key303",
+      "is":{
+        "top":true
+      }
+    },
+    "key305": {
+      "top":"key300",
+      "right":"key306",
+      "bottom":"key310",
+      "left":"key304"
+    },
+    "key306": {
+      "top":"key301",
+      "right":"key307",
+      "bottom":"key311",
+      "left":"key305"
+    },
+    "key307": {
+      "top":"key302",
+      "right":"key308",
+      "bottom":"key312",
+      "left":"key306"
+    },
+    "key308": {
+      "top":"key303",
+      "right":"key309",
+      "bottom":"key308",
+      "left":"key307"
+    },
+    "key309": {
+      "top":"key304",
+      "right":"key310",
+      "bottom":"key309",
+      "left":"key308"
+    },
+    "key310": {
+      "top":"key305",
+      "right":"key311",
+      "bottom":"key310",
+      "left":"key309"
+    },
+    "key311": {
+      "top":"key306",
+      "right":"key312",
+      "bottom":"key311",
+      "left":"key310"
+    },
+    "key312": {
+      "top":"key307",
+      "right":"key312",
+      "bottom":"key312",
+      "left":"key311"
+    }
-
   };
 
-
-
   var model_navigation_expiration = {
-      "key200": {
-        "top":"key200",
-        "right":"key201",
-        "bottom":"key206",
-        "left":"key200",
-        "is":{
-          "top":true
-        }
-      },
-      "key201": {
-        "top":"key201",
-        "right":"key202",
-        "bottom":"key207",
-        "left":"key201",
-        "is":{
-          "top":true
-        }
-      },
-      "key202": {
-        "top":"key202",
-        "right":"key206",
-        "bottom":"key208",
-        "left":"key201",
-        "is":{
-          "top":true
-        }
-      },
-      "key203": {
-        "top":"key203",
-        "right":"key203",
-        "bottom":"key209",
-        "left":"key204",
-        "is":{
-          "top":true
-        }
-      },
-      "key204": {
-        "top":"key204",
-        "right":"key205",
-        "bottom":"key210",
-        "left":"key203",
-        "is":{
-          "top":true
-        }
-      },
-      "key205": {
-        "top":"key205",
-        "right":"key209",
-        "bottom":"key211",
-        "left":"key204"
-      },
-      "key206": {
-        "top":"key200",
-        "right":"key207",
-        "bottom":"key212",
-        "left":"key202"
-      },
-      "key207": {
-        "top":"key201",
-        "right":"key208",
-        "bottom":"key213",
-        "left":"key206"
-      },
-      "key208": {
-        "top":"key202",
-        "right":"key212",
-        "bottom":"key214",
-        "left":"key207"
-      },
-      "key209": {
-        "top":"key203",
-        "right":"key210",
-        "bottom":"key215",
-        "left":"key205"
-      },
-      "key210": {
-        "top":"key204",
-        "right":"key211",
-        "bottom":"key216",
-        "left":"key209"
-      },
-      "key211": {
-        "top":"key205",
-        "right":"key215",
-        "bottom":"key217",
-        "left":"key210"
-      },
-      "key212": {
-        "top":"key206",
-        "right":"key213",
-        "bottom":"key218",
-        "left":"key208"
-      },
-      "key213": {
-        "top":"key207",
-        "right":"key214",
-        "bottom":"key219",
-        "left":"key212"
-      },
-      "key214": {
-        "top":"key208",
-        "right":"key218",
-        "bottom":"key220",
-        "left":"key213"
-      },
-      "key215": {
-        "top":"key209",
-        "right":"key216",
-        "bottom":"key221",
-        "left":"key211"
-      },
-      "key216": {
-        "top":"key210",
-        "right":"key217",
-        "bottom":"key222",
-        "left":"key215"
-      },
-      "key217": {
-        "top":"key211",
-        "right":"key221",
-        "bottom":"key223",
-        "left":"key216"
-      },
-      "key218": {
-         "top":"key212",
-         "right":"key219",
-         "bottom":"key218",
-         "left":"key214"
-       },
-      "key219": {
-         "top":"key213",
-         "right":"key220",
-         "bottom":"key219",
-         "left":"key218"
-       },
-      "key220": {
-         "top":"key214",
-         "right":"key220",
-         "bottom":"key220",
-         "left":"key219"
-       },
-      "key221": {
-         "top":"key215",
-         "right":"key222",
-         "bottom":"key221",
-         "left":"key217"
-       },
-      "key222": {
-         "top":"key216",
-         "right":"key223",
-         "bottom":"key222",
-         "left":"key221"
-       },
-      "key223": {
-         "top":"key217",
-         "right":"key223",
-         "bottom":"key223",
-         "left":"key222"
-       }
+    "key200": {
+      "top":"key200",
+      "right":"key201",
+      "bottom":"key206",
+      "left":"key200",
+      "is":{
+        "top":true
+      }
+    },
+    "key201": {
+      "top":"key201",
+      "right":"key202",
+      "bottom":"key207",
+      "left":"key201",
+      "is":{
+        "top":true
+      }
+    },
+    "key202": {
+      "top":"key202",
+      "right":"key206",
+      "bottom":"key208",
+      "left":"key201",
+      "is":{
+        "top":true
+      }
+    },
+    "key203": {
+      "top":"key203",
+      "right":"key203",
+      "bottom":"key209",
+      "left":"key204",
+      "is":{
+        "top":true
+      }
+    },
+    "key204": {
+      "top":"key204",
+      "right":"key205",
+      "bottom":"key210",
+      "left":"key203",
+      "is":{
+        "top":true
+      }
+    },
+    "key205": {
+      "top":"key205",
+      "right":"key209",
+      "bottom":"key211",
+      "left":"key204"
+    },
+    "key206": {
+      "top":"key200",
+      "right":"key207",
+      "bottom":"key212",
+      "left":"key202"
+    },
+    "key207": {
+      "top":"key201",
+      "right":"key208",
+      "bottom":"key213",
+      "left":"key206"
+    },
+    "key208": {
+      "top":"key202",
+      "right":"key212",
+      "bottom":"key214",
+      "left":"key207"
+    },
+    "key209": {
+      "top":"key203",
+      "right":"key210",
+      "bottom":"key215",
+      "left":"key205"
+    },
+    "key210": {
+      "top":"key204",
+      "right":"key211",
+      "bottom":"key216",
+      "left":"key209"
+    },
+    "key211": {
+      "top":"key205",
+      "right":"key215",
+      "bottom":"key217",
+      "left":"key210"
+    },
+    "key212": {
+      "top":"key206",
+      "right":"key213",
+      "bottom":"key218",
+      "left":"key208"
+    },
+    "key213": {
+      "top":"key207",
+      "right":"key214",
+      "bottom":"key219",
+      "left":"key212"
+    },
+    "key214": {
+      "top":"key208",
+      "right":"key218",
+      "bottom":"key220",
+      "left":"key213"
+    },
+    "key215": {
+      "top":"key209",
+      "right":"key216",
+      "bottom":"key221",
+      "left":"key211"
+    },
+    "key216": {
+      "top":"key210",
+      "right":"key217",
+      "bottom":"key222",
+      "left":"key215"
+    },
+    "key217": {
+      "top":"key211",
+      "right":"key221",
+      "bottom":"key223",
+      "left":"key216"
+    },
+    "key218": {
+      "top":"key212",
+      "right":"key219",
+      "bottom":"key218",
+      "left":"key214"
+    },
+    "key219": {
+      "top":"key213",
+      "right":"key220",
+      "bottom":"key219",
+      "left":"key218"
+    },
+    "key220": {
+      "top":"key214",
+      "right":"key220",
+      "bottom":"key220",
+      "left":"key219"
+    },
+    "key221": {
+      "top":"key215",
+      "right":"key222",
+      "bottom":"key221",
+      "left":"key217"
+    },
+    "key222": {
+      "top":"key216",
+      "right":"key223",
+      "bottom":"key222",
+      "left":"key221"
+    },
+    "key223": {
+      "top":"key217",
+      "right":"key223",
+      "bottom":"key223",
+      "left":"key222"
+    }
   };
   
   // The same view will use this navigation model.
@@ -1717,22 +1734,18 @@
       }
     }      
   };
-  // we need to bind to the keys of the device partner's codes
-  var model_key_codes = {
-    "13" : "KEY_ENTER",
-    "27" : "KEY_ESCAPE",
-    "37" : "KEY_LEFT",
-    "38" : "KEY_UP",
-    "39" : "KEY_RIGHT",
-    "40" : "KEY_DOWN"
-  };
-
+  
-
   var osk_templates = {
     'alpha': [ { 'row' : 0 , 'cells' : ['single','single','single','single','single','single','single', 'single','single','single' ]},
              { 'row' : 1 , 'cells' : ['single','single','single','single','single','single','single', 'single','single','single' ]},
              { 'row' : 2 , 'cells' : ['single','single','single','single','single','single','single', 'single','single','single' ]},
              { 'row' : 3 , 'cells' : ['cmd double','single','single','single','single','single','single', 'single','single' ]},
+             { 'row' : 4 , 'cells' : ['cmd double','cmd','single','cmd double','cmd','cmd','cmd double' ]}
+    ],
+    'accent': [ { 'row' : 0 , 'cells' : ['single','single','single','single','single','single','single', 'single','single','single' ]},
+             { 'row' : 1 , 'cells' : ['single','single','single','single','single','single','single', 'single','single','single' ]},
+             { 'row' : 2 , 'cells' : ['single','single','single','single','single','single','single', 'single','single','single' ]},
+             { 'row' : 3 , 'cells' : ['cmd double','single','single','single','single','single','single', 'single','single' ]},
              { 'row' : 4 , 'cells' : ['cmd double','cmd double','cmd double','cmd','cmd','cmd double' ]}
     ],
     'symbol':[ { 'row' : 0 , 'cells' : ['single','single','single','single','single','single','single', 'single','single','single' ]},
@@ -1775,8 +1788,7 @@
   window.model_keys_expiration = model_keys_expiration;
   window.model_navigation_expiration = model_navigation_expiration;
   window.model_navigation_numbers = model_navigation_numbers;
-  window.model_key_codes = model_key_codes;
   window.osk_templates = osk_templates;
   window.model_keys_numbers = model_keys_numbers;
 
-})(window, document, N);
\ No newline at end of file
+})(window, document, N);
Index: ../../WebEng/monthly/javaweb/public_html/layout/jscript_src/nrd_core.js
===================================================================
--- ../../WebEng/monthly/javaweb/public_html/layout/jscript_src/nrd_core.js	(revision 1)
+++ ../../WebEng/monthly/javaweb/public_html/layout/jscript_src/nrd_core.js	(revision )
@@ -18,19 +18,46 @@
     };
   })();
   
+  // A simple way to check for HTML strings or ID strings
+	// (both of which we optimize for)
+	var quickExpr = /^(?:[^<]*(<[\w\W]+>)[^>]*$|#([\w\-]+)$)/;
+  
   var Core = function(selector, root){
     return new Core.fn.initialize(selector, root);
   };
   
   Core.fn = Core.prototype = {
-    initialize:function(selector, root){
+    initialize:function(selector, root) {
+      // Are we dealing with HTML string or an ID?
+      var match = quickExpr.exec( selector ), retval = [];
+      // Verify a match, and that no context was specified for #id
+      if ( match && !match[1]) {
+        // Otherwise, we inject the element directly into the N object
+        this.length = 1;
+        this[0] = document.getElementById( match[2] );
+        return this;
+      } else {
-      if(root) {     
-        root = typeof(root) == "string" ? document.getElementById(root) : root; 
+        if(root) {     
+          root = typeof(root) == "string" ? document.getElementById(root) : root; 
-        return rootedQuerySelectorAll(root, selector);
+          retval = rootedQuerySelectorAll(root, selector);
-      } else {
+        } else {
-        return document.querySelectorAll(selector);
+          retval = document.querySelectorAll(selector);
-      }   
+        }
+        
+        for(var i = 0, l = retval.length; i < l; i++){
+          this.push(retval[i]);
-    }
+        }
+        return this;   
+      }
+    },
+    // The default length of a N object is 0
+    length: 0,
+    
+    // For internal use only.
+    // Behaves like an Array's method, not like a N method.
+    push: Array.prototype.push,
+    sort: [].sort,
+    splice: [].splice
   };
   
   Core.fn.initialize.prototype = Core.fn;  
@@ -119,8 +146,112 @@
   	// Return the modified object
   	return target;
   };  
-    
+  
+  Core.offsetAndRect = function( elem ) {
+		if ( !elem || !elem.ownerDocument ) {
+			return null;
+		}
+
+		try {
+			var box = elem.getBoundingClientRect();
+		} catch(e) {}
+
+		var doc = elem.ownerDocument,
+			docElem = doc.documentElement;
+
+		var body = doc.body,
+			win = getWindow(doc),
+			clientTop  = docElem.clientTop  || body.clientTop  || 0,
+			clientLeft = docElem.clientLeft || body.clientLeft || 0,
+			scrollTop  = (win.pageYOffset || docElem.scrollTop  || body.scrollTop ),
+			scrollLeft = (win.pageXOffset || docElem.scrollLeft || body.scrollLeft),
+			top  = box.top  + scrollTop  - clientTop,
+			left = box.left + scrollLeft - clientLeft;
+
+		return { top: top, left: left, width: box.width, height: box.height };
+	};
+
+	function getWindow( elem ) {
+  	return elem.nodeType === 9 ?
+  		elem.defaultView || elem.parentWindow :
+  		false;
+  };
+
+	Core.getOffsetParent=function( elem ) {
+	  /* returns the positioning container of the element. Every positioned element 
+	   * (be it relative or absolute positioning) has a positioning container, which 
+	   * is defined by a nontrivial set of rules in the CSS specification, 
+	   * as the 'CSS-containing block.' 
+	   */
+	  if ( !elem || !elem.ownerDocument ) {
+			return null;
+		}
+
+		if (elem.offsetParent) {
+		  return elem.offsetParent;
+		}
+		
+		var doc = elem.ownerDocument,
+			docElem = doc.documentElement,
+			body = doc.body,
+			win = getWindow(doc);
+			
+		if (elem === body) {
+		  return elem;
+		}
+
+		while ((elem = elem.parentNode) && elem !== body) {
+			if (win.getComputedStyle(elem, null)['position'] !== 'static') {
+				return elem;
+			}
+		}
+		return body;
+	};
+	
+ 	
+  Core.fn.extend({
+    addClass:function(value){
+      if ( value && typeof value === "string" ) {
+ 
+        for ( var i = 0, l = this.length; i < l; i++ ) {
+          var elem = this[i];
+
+          if ( elem.nodeType === 1 ) {
+            if ( !elem.className ) {
+              elem.className = value;
+            } else {
+              var classNames = elem.className;
+              if ( !(classNames.length > 0 && (classNames == value || new RegExp("(^|\\s)" + value + "(\\s|$)").test(classNames)))) {
+                elem.className += (elem.className ? ' ' : '') + value;  
+              }
+            }
+          }
+        }
+      }
+      return this;
+    },
+    removeClass:function(value){
+      if ( (value && typeof value === "string") || value === undefined ) {
+        
+        for ( var i = 0, l = this.length; i < l; i++ ) {
+          var elem = this[i];
+
+          if ( elem.nodeType === 1 && elem.className ) {
+            if ( value ) {
+              elem.className = elem.className.replace(
+                new RegExp("(^|\\s+)" + value + "(\\s+|$)"), ' ');
+            } else {
+              elem.className = "";
+            }
+          }
+        }
+      }
+      return this;
+    }
+  });
+	
+    
   // Expose Core to the global object
   window.N = Core;
   
-})(window, document);
\ No newline at end of file
+})(window, document);
Index: ../../WebEng/monthly/javaweb/public_html/layout/jscript_src/nrd_osk_super_controller.js
===================================================================
--- ../../WebEng/monthly/javaweb/public_html/layout/jscript_src/nrd_osk_super_controller.js	(revision 6)
+++ ../../WebEng/monthly/javaweb/public_html/layout/jscript_src/nrd_osk_super_controller.js	(revision )
@@ -1,5 +1,62 @@
 (function(window, document, N, undefined) {    
+  N.NRDUtil = netflix.NRDUtil;
+  N.NRDKeyHandler = netflix.NRDKeyHandler;
-        
+  
+  var key_navigation = {
+    "osk-input-text": {
+      "top":"osk-enter",
+      "right":null,
+      "bottom":true,
+      "left":null,
+      "focus":function(){
+      },
+      "blur":function(){
+      },
+      "action":function(){
+        // no-op
+      }
+    },
+    "osk-close-top": {
+      "top":null,
+      "right":null,
+      "bottom":null,
+      "left":null,
+      "action":function() {
+        this.hideOskLayer(false);
+      }
+    },
+    "osk-close": {
+      "top":true,
+      "right":"osk-enter",
+      "bottom":"osk-input-text",
+      "left":"osk-enter",
+      "focus":function(){
+        N("#osk-close").addClass("focus");
+      },
+      "blur":function(){
+        N("#osk-close").removeClass("focus");
+      },
+      "action":function() {
+        this.hideOskLayer(false);
+      }
+    },
+    "osk-enter": {
+      "top":true,
+      "right":"osk-close",
+      "bottom":"osk-input-text",
+      "left":"osk-close",
+      "focus":function(){
+        N("#osk-enter").addClass("focus");
+      },
+      "blur":function(){
+        N("#osk-enter").removeClass("focus");
+      },
+      "action":function() {
+        this.hideOskLayer(true);
+      }
+    }
+  };
+  
   var F = function(options) {
     return new F.fn.initialize(options);
   };
@@ -7,15 +64,23 @@
   F.fn = F.prototype = {
     initialize:function(options){
       options = options || {};
-      options.osk_highlight_selector = options.osk_highlight_selector || '#osk-cell-highlight';
+      options.osk_highlight_selector = options.osk_highlight_selector;
       var eleOskContainer = N(options.osk_selector) || [];
       this.my_state = {};
       this.my_state["options"] = options;
       this.my_state["osk_controllers"] = [];
+      this.my_state["options"] = options;
+      this.my_state["osk_layer"] = N(options.osk_layer_selector)[0];
+      this.my_state["osk_keys_container"] = eleOskContainer[0];
+      this.my_state["key_navigation"] = options.key_navigation || {};
+      var keyCodes = this.my_state["key_codes"] = options.key_codes || {};
       
+      var defaults = {"cb": null, "target": null, "value": null, "type":"text", "title":null};
+      this.my_state["show_osk_options"] = defaults;
+      
       N.extend(F.prototype, N.PubSub.prototype);
-      this.wireUpEvents(eleOskContainer);  
+      this.wireUpEvents(eleOskContainer[0]);  
-      
+            
       var controllers = this.getControllers(),
         controller, keyNames;
       
@@ -29,9 +94,10 @@
         "model_key_default_state_index": 0,
         "model_key_default_key": "key000",
         "model_navigation": model_navigation_alpha,
-        "model_key_codes": model_key_codes,
+        "model_key_codes": keyCodes,
         "osk_highlight_selector": options.osk_highlight_selector,
-        "osk_template" : window.osk_templates['alpha'],
+        "osk_highlight_style": {"top": 1, "left": 1, "width": 2, "height":2},
+        "osk_template" : osk_templates['alpha'],
         "lazy_init_rect": true 
       });
       keyNames = controller.getModelKeyNames();
@@ -40,8 +106,6 @@
         "model": keyNames
       });
 
-      //this.setActiveController(controller);
-      //controller.gotoDefaultKey();
       
       // load the accent view
       controller = N.osk.controller({
@@ -53,9 +117,10 @@
         "model_key_default_state_index": 0,
         "model_key_default_key": "key100",
         "model_navigation": model_navigation_accent,
-        "model_key_codes": model_key_codes,
+        "model_key_codes": keyCodes,
         "osk_highlight_selector": options.osk_highlight_selector,
-        "osk_template" : window.osk_templates['alpha'],
+        "osk_highlight_style": {"top": 1, "left": 1, "width": 2, "height":2},
+        "osk_template" : osk_templates['accent'],
         "lazy_init_rect": true 
       });
       keyNames = controller.getModelKeyNames();
@@ -63,125 +128,363 @@
         "controller": controller,
         "model": keyNames
       });
-
-      // load the expiration view
-      controller = N.osk.controller({
-        "super_controller": this,
-        "view_selector":"#osk-view-c.osk-view",
-        "osk_cell_selector": "#osk-view-c.osk-view .osk-cell",
-        "model_keys": model_keys_expiration,
-        "model_key_default_state_name": "expiration",
-        "model_key_default_state_index": 0,
-        "model_key_default_key": "key200",
-        "model_navigation": model_navigation_expiration,
-        "model_key_codes": model_key_codes,
-        "osk_highlight_selector": options.osk_highlight_selector,
-        "osk_template" : window.osk_templates['expiration'],
-        "lazy_init_rect": true
-      });
-      keyNames = controller.getModelKeyNames();
-      controllers.push({
-        "controller": controller,
-        "model": keyNames
-      });
-
-      // load the numbers view
-      controller = N.osk.controller({
-        "super_controller": this,
-        "view_selector":"#osk-view-d.osk-view",
-        "osk_cell_selector": "#osk-view-d.osk-view .osk-cell",
-        "model_keys": model_keys_numbers,
-        "model_key_default_state_name": "numbers",
-        "model_key_default_state_index": 0,
-        "model_key_default_key": "key300",
-        "model_navigation": model_navigation_numbers,
-        "model_key_codes": model_key_codes,
-        "osk_highlight_selector": options.osk_highlight_selector,
-        "osk_template" : window.osk_templates['number'],
-        "lazy_init_rect": true
-      });
-      keyNames = controller.getModelKeyNames();
-      controllers.push({
-        "controller": controller,
-        "model": keyNames
-      });
     },
     wireUpEvents:function(oskContainer){
-      oskContainer = oskContainer || [];
-      
-      if(oskContainer.length === 1) {     
-        oskContainer = oskContainer[0];
-        
-        var clickHandler = N.bind( this.clickHandler, this );
-        oskContainer.addEventListener('click', clickHandler, false);
-
-        var keyDownHandler = N.bind( this.keyDownHandler, this );
-        document.addEventListener('keydown', keyDownHandler, false);
-
+      if(oskContainer) {
         var mouseOverHandler = N.bind( this.mouseOverHandler, this );
         oskContainer.addEventListener('mouseover', mouseOverHandler, false);
 
         var mouseOutHandler = N.bind( this.mouseOutHandler, this );
         oskContainer.addEventListener('mouseout', mouseOutHandler, false);
-      } else {
-        console.info("Container is null, can't attach events to it.");
-      }
+      } 
       
       // Handle the keypress event
       var keyPressHandler = N.bind( this.keyPressHandler, this );
-      this.observe("keypress", keyPressHandler);      
+      this.observe("key-press", keyPressHandler);      
       
+      var keyDownHandler = N.bind( this.keyDownHandler, this );
+      this.observe("key-down", keyDownHandler);
+      
       var keyLeavingHandler = N.bind( this.keyLeavingHandler, this );
       this.observe("key-leaving", keyLeavingHandler);
       
       var keyEnteringHandler = N.bind( this.keyEnteringHandler, this );
       this.observe("key-entering", keyEnteringHandler);
       
-      var keyEscapeHandler = N.bind( this.keyEscapeHandler, this );
-      this.observe("key-escape", keyEscapeHandler);
-      
       var viewSwapHandler = N.bind( this.viewSwapHandler, this );
       this.observe("view-swap", viewSwapHandler);
-
+      
-      var leaveTopHandler = N.bind( this.leaveTopHandler, this );
-      this.observe("leave-top", leaveTopHandler);
+      var clickHandler = N.bind( this.clickHandler, this );
+      this.observe("key-click", clickHandler);
+      
+      var caretMoveHandler = N.bind( this.caretMoveHandler, this );
+      this.observe("caret-move", caretMoveHandler);
     },
-    addSubscriber:function(evtName, handler){
-      this.observe(evtName, handler);
+    nearest:function(elm, tag) {
+      while (elm && elm.nodeName !== tag) {
+        elm = elm.parentNode;
+      }
+      return elm;
     },
-    clickHandler:function(e){
-      var controller = this.getActiveController();
-      if(!controller) return;
-      controller.notify("click", e);
+    showOskLayer:function(options) {
+      var eleOskLayer = this.getOskLayer();
+      N.NRDUtil.beginSmoke();   
+      eleOskLayer.style.display = 'block';
+      
+      var defaults = {"cb": null, "target": null, "value": null, "type":"text", "title":null};
+      options = N.extend(defaults, options || {});
+      this.my_state["show_osk_options"] = options;
+      
+      N('#osk-title')[0].innerHTML = options.title || "&nbsp;";
+      N('#osk-input-text')[0].style.display = "block";
+      N('#osk-expiration-text')[0].style.display = "none";
+
+      var type = options.type;
+      if (type === 'text') {
+        this.notify('view-swap', 'alpha');
+      } else if (type === 'password') {
+        // no-op
+      } else if (type === 'expiration') {
+        N('#osk-input-text')[0].style.display = "none";
+        N('#osk-expiration-text')[0].style.display = "block";
+        this.notify('view-swap', 'expiration');
+      } else if (type === 'number') {
+        this.notify('view-swap', 'numbers');
+      }
+      
+      // TODO This doesn't work well -> going to move it centering with CSS if possible
+      N.NRDUtil.centerRelative(".wii-res", eleOskLayer); /* using .wii-res in place of .main-b */
+      
+      // this is how we get the clicks/keydown events
+      var nrdKeyClickHandler = N.bind( this.nrdKeyClickHandler, this );
+      N.NRDKeyHandler.push(nrdKeyClickHandler);
+      
+      window.setTimeout( N.bind(this.getOskKeyContainerRect, this), 200);
+
+      // give the input field the focus and put the caret at the end to begin with.
+      var ele = document.getElementById("osk-input-text");
+      ele.focus();
+      var len = ele.value.length;
+      ele.setSelectionRange(len, len);
     },
-    leaveTopHandler: function(e) {
-      console.log(e + " event was captured ");
+    hideOskLayer:function(flag) {
+      var options = this.getOptions(),
+        eleOskLayer = N(options.osk_layer_selector) || [],
+        options = this.my_state["show_osk_options"] || {};
+
+      N.NRDUtil.endSmoke();
+      eleOskLayer[0].style.display = 'none';
+      N.NRDKeyHandler.pop();
+      this.setOskKeyContainerRect(null);
+      
+      if (flag && options.cb) {
+       if (options.target) {
+         options.target.value = N('#osk-input-text')[0].value;
+       }
+       var opts = {};
+       if (options.target.type === 'expiration') {
+         opts.month = N('#osk-input-month')[0].value;
+         opts.year = N('#osk-input-year')[0].value;
+       };
+       options.cb(opts);
+      }
     },
-    keyDownHandler:function(e) {
-      var controller = this.getActiveController();
-      if(!controller) return;
-      controller.notify("keydown", e);
+    clickHandler:function(evtName, e){
+      this.lct = e.target;   // last click target 
+
+      var button = this.nearest(e.target, "BUTTON"),
+        options = this.getOptions(),
+        navigationModel = this.getKeyNavigation(),
+        navigable = navigationModel[currentOsk] || {},
+        currentOsk;
+  
+      if(button) {
+        currentOsk = button.getAttribute('id');
+        navigable = navigationModel[currentOsk] || {};
+
+        var func = navigable["action"];
+        if(func && typeof(func) === "function"){
+          func.apply(this, arguments);
+        }
+      }
     },
+    isVisible:function() {
+      var eleOskLayer = this.getOskLayer();
+      return eleOskLayer.style.display === 'block' ? true : false;
+    },
+    getOskKeyContainerRect:function(){
+      var rect = this.my_state["osk_key_container_rect"];
+      if(!rect){
+        var oskKeyContainer = this.getOskKeysContainer(),
+          keyContainerRect = N.offsetAndRect(oskKeyContainer);
+        rect = {
+          "x": keyContainerRect.left, 
+          "y": keyContainerRect.top, 
+          "xend": keyContainerRect.left + keyContainerRect.width, 
+          "yend": keyContainerRect.top + keyContainerRect.height
+        };
+        this.setOskKeyContainerRect(rect);
+      }
+      return rect;
+    },
+    setOskKeyContainerRect:function(obj){
+      var defaults = {"x": 0, "y": 0, "xend": 0, "yend":0};
+      if(obj){
+        obj = N.extend(defaults, obj || {});
+      }
+      this.my_state["osk_key_container_rect"] = obj;
+    },
+    nrdKeyClickHandler:function(e) {
+      // dispatch the events between the osk controller and us here.
+      // this only applies for click/keydown events from the
+      // NRDKeyHandler stack
+      var controller = this.getActiveController(),
+        evtType = e.type,
+        retval = [];
+      
+      // we have two click areas to handle. the area that contains
+      // key views and the area outside of that.
+      if(evtType === 'click') {
+        var rect = this.getOskKeyContainerRect(),
+          clientX = e.clientX,
+          clientY = e.clientY;
+
+        if(clientX >= rect.x && clientX <= rect.xend && 
+          clientY >= rect.y && clientY <= rect.yend) {
+            if(controller){
+              controller.notify("key-click", e);
+            }  
+        } else {
+          this.notify("key-click", e);
+        }        
+      } else if(evtType === 'keydown') {
+        // the osk keys key-down event will only be handled 
+        // if there's a currently selected key.
+        if(controller){
+          retval = controller.notify("key-down", e);
+        }
+        
+        var handled = true;
+        if(retval.length) {
+          for(var i = 0, l = retval.length; i < l; i++) {
+            if(!retval[i]) {
+              handled = false;
+              break;
+            }
+          }
+        } else {
+          handled = false;
+        }
+        
+        if(!handled){
+          this.notify("key-down", e);
+        } else {
+          // if preventDefault exists run it on the original event
+          if ( e.preventDefault ) {
+            e.preventDefault();
+          }
+        }
+      }
+    },
     mouseOverHandler:function(e){
       var controller = this.getActiveController();
       if(!controller) return;
-      controller.notify("mouseover", e);
+      controller.notify("mouse-over", e);
     },
     mouseOutHandler:function(e){
       var controller = this.getActiveController();
       if(!controller) return;
-      controller.notify("mouseout", e);
+      controller.notify("mouse-out", e);
     },
+    keyDownHandler:function(evtName, e) {
+      // this was dispatched from the nrdKeyClickHandler
+      // but only if it wasn't handled by a osk controller.
+      var keyCodes = this.getKeyCodes(),
+        keycode = keyCodes["" + e.keyCode],
+        options = this.getOptions(),
+        currentOsk = this.getCurrentKeyId() || options["default_key"],
+        navigationModel = this.getKeyNavigation(),
+        navigable = navigationModel[currentOsk] || {},
+        goingTo;
-
+        
+      var helperFunc = N.bind(function(dir) {
+        goingTo = navigable[dir];
+        if(goingTo) {
+          if(typeof(goingTo) === "boolean"){
+            var controller = this.getActiveController(), keyId;
+
+            if(dir==="bottom"){
+              keyId = this.my_state["down_key_id"];
+            } else if (dir ==="top") {
+              keyId = this.my_state["up_key_id"];
+            } 
+          
+            if(controller && keyId){
+              controller.gotoKey(keyId, true);
+              this.goToKey(null);
+            }
+          } else {
+            this.goToKey(goingTo);
+          }
+        } else {
+          // no-op
+        }
+        
+      }, this);
+                      
+      var whatStep = {
+        "key.enter" : function() {
+          var func = navigable["action"];
+          if(func && typeof(func) === "function"){
+            func.apply(this, arguments);
+          }
+        },
+        "key.back":function() {
+          return false; /* don't override any behavior */
+        },
+        "key.exit" : function() {
+          this.hideOskLayer(false);
+        },
+        "key.up" : function() {
+          helperFunc("top");
+        },
+        "key.right" : function() {
+          helperFunc("right");
+        },
+        "key.down" : function() {
+          helperFunc("bottom");
+        },
+        "key.left" : function() {
+          helperFunc("left");
+        },
+        "no.op" : function() { 
+          return false; /* don't override any behavior */
+        }
+      };      
+      var fn = whatStep[keycode] || whatStep["no.op"];
+      fn.apply(this);
+      // since we didn't return, it means we handled 
+      // the key, so lets stop its propogation.
+      // IF you want the user to be able to move the caret left/right 
+      // while in the input box, uncomment this line:
+      // if(this.getCurrentKeyId() !== "osk-input-text")
+      if ( e.preventDefault ) {
+        e.preventDefault();
+      }
+      e.cancelBubble = true;
+      return false;
+    },
-    keyPressHandler:function(evtName, ch){
+    keyPressHandler:function(evtName, ch) {
-      console.log(evtName + " event was captured wiht value " + ch);
+      // this was an event being fired from the osk controller, 
+      // giving us a key character. 
+      var options = this.my_state["show_osk_options"] || {},
+        type = options.type;
+ 
+      if (type === 'text' || type === 'password' || type === 'number') {
+        var inpElement = N('#osk-input-text')[0];
+        // insert At Caret
+        var start = inpElement.selectionStart; 
+        var end   = inpElement.selectionEnd; 
+
+        /* Remember obj is a textarea or input field */ 
+        inpElement.value = inpElement.value.substr(0, start) 
+            + ch 
+            + inpElement.value.substr(end, inpElement.value.length);
+        
+        // reposition the caret to where it was before
+        inpElement.setSelectionRange(start+1, end+1);
+      } else if (type === 'expiration') {
+        if (ch.length !== 4) {
+          N('#osk-input-month')[0].value = ch;
+        } else {
+          N('#osk-input-year')[0].value = ch;
+        }
+      }
     },
+    caretMoveHandler:function(evtName, direction){
+      //console.log(evtName + " was handled, we need to implement moving the caret " + direction);
+      var ele = document.getElementById("osk-input-text"),
+        len = ele.value.length,
+        pos = 0;
+      
+      if(direction === "go.right"){
+        var end = ele.selectionEnd;
+        if(end < len){
+          pos = end + 1;
+        }
+      } else if(direction === "go.left") {
+        var start = ele.selectionStart; 
+        if(start > 0 ) {
+          pos = start - 1;
+        }
+      } else if(direction ==="go.backspace") {
+        var inpElement = N('#osk-input-text')[0],
+          start = ele.selectionStart,
+          end = ele.selectionEnd,
+          val = inpElement.value;
+          
+        if(start === end) {
+          start = start - 1;
+          if(start >= 0){
+            inpElement.value = val.substr(0, start) + val.substr(end, val.length);
+            pos = start;
+          }
+        } else {
+          inpElement.value = val.substr(0, start) + val.substr(end, val.length);
+          pos = start;
+        }
+      }
+      
+      ele.setSelectionRange(pos, pos);
+      
+    },
     keyLeavingHandler:function(evtName, oskId, navModel){
       navModel = navModel || {};
       navModel.is = navModel.is || {};
       var defaults = N.extend({"top":false, "right":false, "bottom":false, "left":false}, navModel.is || {});
       N.extend(navModel.is, defaults);
       this.setLeavingOskKeyNavModel({"id": oskId, "model":navModel});
+      this.my_state["just_left_key_id"] = oskId;
     },
     keyEnteringHandler:function(evtName, oskId, navModel){
       navModel = navModel || {};
@@ -193,19 +496,47 @@
         tokey = {"id": oskId, "model":navModel};
       if(prevkey.id && prevkey.model.is){
         if(prevkey.model.is.top && tokey.model.is.bottom){
-          console.log("preventing top to bottom navigation wrapping. would of gone to key " + oskId + ", or " + prevkey.model.top + ". Use that id in the gotoKey().");
+          this.my_state["up_key_id"] = oskId;
+          this.my_state["down_key_id"] = this.my_state["just_left_key_id"];
+          this.setLeavingOskKeyNavModel(null); /* clear the state */
+          this.goToKey("osk-input-text");
           return false;
         } else if(prevkey.model.is.bottom && tokey.model.is.top){
-          console.log("preventing bottom to top navigation wrapping. would of gone to key " + oskId+ ", or " + prevkey.model.bottom + ". Use that id in the gotoKey().");
+          this.my_state["up_key_id"] = this.my_state["just_left_key_id"]
+          this.my_state["down_key_id"] = oskId;
+          this.setLeavingOskKeyNavModel(null); /* clear the state */
+          this.goToKey("osk-enter");          
           return false;
         }
       } else {
         this.setLeavingOskKeyNavModel(null); /* clear the state */
       }
-    },
+    },   
-    keyEscapeHandler:function(evtName, e){
-      console.log(evtName + " event was captured wiht value " + e);
+    goToKey:function(keyId) {
+      var navigationModel = this.getKeyNavigation(),
+        currentKeyId = this.getCurrentKeyId(), ele;
+      
+      this.setCurrentKeyId(keyId);
+      
+      if(keyId){
+        var to = navigationModel[keyId] || {};
+        if(typeof(to.focus) === "function") {
+          to.focus();
+        } else {
+          document.getElementById(keyId).focus();
+        }
+    
+      }
+      
+      if(currentKeyId) {  
+        var from = navigationModel[currentKeyId] || {};
+        if(typeof(from.blur) === "function") {
+          from.blur();
+        } else {
+          document.getElementById(currentKeyId).blur();
+        }
+      }
-    },
+    },  
     setActiveController:function(controller){
       var before = this.my_state["active_osk_controller"];
       before && before.hideView && before.hideView();
@@ -217,7 +548,6 @@
       }
     },
     viewSwapHandler:function(evtName, stateName){
-      //console.log(evtName + " event was captured wiht value " + stateName);
       var controllers = this.getControllers(),
         modelKeyNames, controller, found = false;
         
@@ -234,7 +564,6 @@
       if(found){
         this.setActiveController(controller.controller);
       }
-
     },
     getActiveController:function(){
       return this.my_state["active_osk_controller"];
@@ -247,182 +576,41 @@
     },
     setLeavingOskKeyNavModel:function(obj){
       this.my_state["leaving_osk_key_nav_model"] = obj;
-    }
-
-  };
-  F.fn.initialize.prototype = F.fn;
-  
-  N.osk = N.osk || {};
-  N.osk.supercontroller = F;
-
- /*
-
-  N.osk.supercontroller = F({
-    "osk_selector":".osk", 
-    "osk_highlight_selector": "#osk_cell_highlight"
-  });  */
-  
-})(window, document, N);
-
-
-
-
-/*
-*    This is the osk layer
-*    we can move it somewhere else, but for now have it here
- */
-netflix.NRDOskLayer = (function(util) {
-   var
-   _oskLayer = document.getElementById('osk-container'),
-   _callbackOnHide = null,
-   _closeButton = document.getElementById('osk-close'),
-   _enterButton = document.getElementById('osk-enter'),
-   _xCloseButton = document.getElementById('osk-close-top'),
-   _targetElement = null,
-   _inputElement = document.getElementById('osk-input-text'),
-   _inputMonth = document.getElementById('osk-input-month'),
-   _inputYear = document.getElementById('osk-input-year'),
-   _initFlag = false,
-   _oskSupperController = null,
-   _oskInputType = 'text',
-   
-   oskHandler = function(evt) {
-      var KeyUtil = util.KeyUtil;
-      var keyCode = KeyUtil.keyCode(evt);
-      var target = evt.target;
-      // handle click events
-     
-      if (evt.type === "click" && (target.tagName === 'BUTTON' )  ) {
-        target.click();
-        return true;
-      }
-      if(target && target.id !== 'osk-enter' &&  target.id !== 'osk-input-text' && target.id !== 'osk-close' ) {
-          _oskSupperController.keyDownHandler('keydown', evt);
-          return true;
-      }
-      if( KeyUtil.keys[keyCode] === "key.up" ) {
-        if( target.id === 'osk-enter') {
-          _oskSupperController.getActiveController().gotoDefaultKey(true);
-          // publish this to the supper controller
-          return true;
-        }
-      }
-      if( KeyUtil.keys[keyCode] === "key.down" ) {
-        if( target.id === 'osk-input-text') {
-          _oskSupperController.getActiveController().gotoDefaultKey(true);
-          // here you have to publish this to the keyboard
-          return true;
-        }
-      }
-      if (KeyUtil.keys[keyCode] === "key.up" ||
-        KeyUtil.keys[keyCode] === "key.down" ||
-        KeyUtil.keys[keyCode] === "key.left" ||
-        KeyUtil.keys[keyCode] === "key.right") {
-        return false;
-      }
-      return false; /* it's modal! */
-  },
+    },
-  isVisible = function() {
-    if( _oskLayer.style.display == 'block')  return true;
-    return false;
+    getOptions:function(){
+      return this.my_state["options"] || {};
-  },
+    },
-  showOskLayer = function( options ) {
-      if( _initFlag === false ) {
-        init();
-        _initFlag = true;
-      }
-      netflix.NRDUtil.beginSmoke();
-      _oskLayer.style.display = 'block';
-      if( options )  {
-        _callbackOnHide = options.callbackOnHide || null;
-        _targetElement = options.targetElement || null;
-        _inputElement.value = options.value || '';
-        _oskInputType = options.inputType || 'text';
-        document.getElementById('osk-title').innerHTML = options.title || '';
-      }
-      var controllerOptions = {};
-      document.getElementById('osk-input-text').style.display = "block";
-      document.getElementById('osk-expiration-text').style.display = "none";
-
-      if( _oskInputType == 'text' ) {
-
-        _oskSupperController.viewSwapHandler('change views', 'alpha' );
-      }
-      else if( _oskInputType == 'password' ) {
-      }
-      else if( _oskInputType == 'expiration' ) {
-        document.getElementById('osk-input-text').style.display = "none";
-        document.getElementById('osk-expiration-text').style.display = "block";
-
-        _oskSupperController.viewSwapHandler('change views', 'expiration' );
-      }
-      else if ( _oskInputType == 'number') {
-
-        _oskSupperController.viewSwapHandler('change views', 'numbers' );
-      }
-      netflix.NRDUtil.centerRelative(".main-b", _oskLayer);
-      netflix.NRDKeyHandler.push(oskHandler);
-      netflix.NRDUtil.focusAndSelect(_enterButton);
+    getOskLayer:function(){
+      return this.my_state["osk_layer"];
-  },
+    },
-  init = function () {
-    _oskSupperController =  N.osk.supercontroller({
-      "osk_selector":".osk",
-      "osk_highlight_selector": "#osk-cell-highlight"
-    });
-    _oskSupperController.addSubscriber("keypress", notifyInputChar);
-    _oskSupperController.addSubscriber("leave-top", function() {
-       if( _oskInputType === 'expiration' ) {
-
-       } else {
-          util.focusAndSelect(_inputElement);
-       }
-    });
-    _closeButton.onclick = function () {
-        hideOskLayer(false);
-        return true;
-     };
-    _enterButton.onclick = function () {
-        hideOskLayer(true);
-        return true;
-    };
-    _xCloseButton.onclick = function() {
-        hideOskLayer(false);
-        return true;
-    }
+    getOskKeysContainer:function(){
+      return this.my_state["osk_keys_container"];
-  },
+    },
-
-  notifyInputChar = function (evtName, text) {
-     if( _oskInputType === 'text' || _oskInputType === 'password' || _oskInputType === 'number')
-        _inputElement.value = _inputElement.value + text;
-     else if( _oskInputType === 'expiration' ) {
-       if( text.length !== 4 )  {
-          _inputMonth.value = text;
-       }
-       else {
-         _inputYear.value = text;
-       }
-     }
+    getKeyCodes:function(){
+      return this.my_state["key_codes"] || {};
-  },
+    },
-  hideOskLayer = function(flag) {
-      netflix.NRDUtil.endSmoke();
-      _oskLayer.style.display = 'none';
-      netflix.NRDKeyHandler.pop();
-      if(flag && _callbackOnHide ) {
-        if( _targetElement ) {
-          _targetElement.value = _inputElement.value;
+    getCurrentKeyId:function(){
+      return this.my_state["current_key"];
+    },
+    setCurrentKeyId:function(id){
+      this.my_state["current_key"] = id;
+    },
+    getKeyNavigation:function(){
+      return this.my_state["key_navigation"] || {};
-        }
+    }
-        var options = {};
-        if( _oskInputType == 'expiration' ) {
-            options.month = _inputMonth.value;
-            options.year = _inputYear.value;
-        };
+  };
-        _callbackOnHide(options);
-      }
-  };
-   return {
-      init:init, showOskLayer: showOskLayer, isVisible:isVisible, notifyInputChar:notifyInputChar
-   };
-})(netflix.NRDUtil);
+  F.fn.initialize.prototype = F.fn;
 
+  N.osk = N.osk || {};
+  N.osk.NRDOskLayer = F({
+    "osk_selector":".osk-keys-container", 
+    "osk_highlight_selector": "#osk-cell-highlight",
+    "osk_layer_selector":"#osk-container",
+    "key_codes":N.NRDUtil.KeyUtil.keys,
+    "key_navigation":key_navigation,
+    "default_key":"osk-enter"
+  });
-
+  
+  N.osk.NRDOskLayer.showOskLayer();
-
+  
+})(window, document, N);
Index: ../../WebEng/monthly/javaweb/netflix_src/netflix/util/javascript/JavascriptClass.java
===================================================================
--- ../../WebEng/monthly/javaweb/netflix_src/netflix/util/javascript/JavascriptClass.java	(revision 423)
+++ ../../WebEng/monthly/javaweb/netflix_src/netflix/util/javascript/JavascriptClass.java	(revision )
@@ -420,6 +420,7 @@
 
   // Non-Member TV
   public static JavascriptClass NM_NRD_CORE;
+  public static JavascriptClass NM_NRD_CORE_LITE;
   public static JavascriptClass NONMEMBER_NRD;
   public static JavascriptClass NM_NRD_CS_CARD;
   public static JavascriptClass NM_NRD_EXIT_LAYER;
@@ -1281,7 +1282,9 @@
     NM_NRD_SELECTBOX = new JavascriptClass("NM_NRD_SELECTBOX", "nrdSelectBox.js", new JavascriptClass[]{NONMEMBER_NRD});
     NM_NRD_SCROLLABLETEXTBOX = new JavascriptClass("NM_NRD_SCROLLABLETEXTBOX", "nrdScrollableTextBox.js", new JavascriptClass[]{NONMEMBER_NRD});
     JavascriptClass[] nrdCoreExperience = new JavascriptClass[]{NONMEMBER_NRD, NRD_AJAX, NM_NRD_OSK, NM_NRD_SELECTBOX, NM_NRD_SCROLLABLETEXTBOX, NM_NRD_CS_CARD, NM_NRD_EXIT_LAYER, NM_PALADIN_AUTOMATION};
+    JavascriptClass[] nrdCoreExperienceLite = new JavascriptClass[]{NONMEMBER_NRD, NRD_AJAX, NM_NRD_CS_CARD, NM_PALADIN_AUTOMATION};
     NM_NRD_CORE = new JavascriptClass("NM_NRD_CORE", "NrdCore", nrdCoreExperience);
+    NM_NRD_CORE_LITE = new JavascriptClass("NM_NRD_CORE_LITE", "NrdCore", nrdCoreExperienceLite);
 
     NM_NRD_MESSAGE = new JavascriptClass("NM_NRD_MESSAGE", "nonmember-nrd-message.js", new JavascriptClass[]{NM_NRD_CORE});
     NM_NRD_LOGIN = new JavascriptClass("NM_NRD_LOGIN", "nonmember-nrd-login.js", new JavascriptClass[]{NM_NRD_CORE});
@@ -1330,16 +1333,16 @@
     NM_NRD_WII_ERROR_LAYER = new JavascriptClass("NM_NRD_WII_ERROR_LAYER", "nonmember-nrd-wii-error-layer.js", NO_DEPENDENCIES);
     NM_NRD_WII_EXIT_LAYER = new JavascriptClass("NM_NRD_WII_EXIT_LAYER", "nonmember-nrd-wii-exit.js", NO_DEPENDENCIES);
 
-    NM_NRD_LANDING_WII = new JavascriptClass("NM_NRD_LANDING_WII", "nonmember-nrd-landing-wii.js", new JavascriptClass[]{NM_NRD_CORE, NM_NRD_WII_ERROR_LAYER, NM_NRD_WII_EXIT_LAYER});
-    NM_NRD_LOGIN_WII = new JavascriptClass("NM_NRD_LOGIN_WII", "nonmember-nrd-login-wii.js", new JavascriptClass[]{NM_NRD_CORE, NM_NRD_WII_ERROR_LAYER, NM_NRD_WII_EXIT_LAYER, NM_NRD_OSK_BASE});
-    NM_NRD_HOME_WII = new JavascriptClass("NM_NRD_HOME_WII", "nonmember-nrd-home-wii.js", new JavascriptClass[]{NM_NRD_CORE, NM_NRD_WII_ERROR_LAYER, NM_NRD_WII_EXIT_LAYER, NM_NRD_OSK_BASE});
-    NM_NRD_ADDRESS_WII = new JavascriptClass("NM_NRD_ADDRESS_WII", "nonmember-nrd-address-wii.js", new JavascriptClass[]{NM_NRD_CORE, NM_NRD_WII_ERROR_LAYER, NM_NRD_WII_EXIT_LAYER});
-    NM_NRD_ORDERFINAL_WII = new JavascriptClass("NM_NRD_ORDERFINAL_WII", "nonmember-nrd-orderfinal-wii.js", new JavascriptClass[]{NM_NRD_CORE, NM_NRD_WII_ERROR_LAYER, NM_NRD_WII_EXIT_LAYER});
-    NM_NRD_PAYMENT_WII = new JavascriptClass("NM_NRD_PAYMENT_WII", "nonmember-nrd-payment-wii.js", new JavascriptClass[]{NM_NRD_CORE, NM_NRD_WII_ERROR_LAYER, NM_NRD_WII_EXIT_LAYER, NM_NRD_OSK_BASE});
-    NM_NRD_MARKETINGSCREEN_WII = new JavascriptClass("NM_NRD_MARKETINGSCREEN_WII", "nonmember-nrd-marketingscreen-wii.js", new JavascriptClass[]{NM_NRD_CORE, NM_NRD_WII_EXIT_LAYER});
-    NM_NRD_ORDERCONFIRMATION_WII = new JavascriptClass("NM_NRD_ORDERCONFIRMATION_WII", "nonmember-nrd-orderconfirmation-wii.js", new JavascriptClass[]{NM_NRD_CORE, NM_NRD_WII_ERROR_LAYER, NM_NRD_WII_EXIT_LAYER, NM_NRD_OSK_BASE});
-    NM_NRD_EDITADDRESS_WII = new JavascriptClass("NM_NRD_EDITADDRESS_WII", "nonmember-nrd-editaddress-wii.js", new JavascriptClass[]{NM_NRD_CORE, NM_NRD_WII_ERROR_LAYER, NM_NRD_WII_EXIT_LAYER});
-    NM_NRD_EDITPAYMENT_WII = new JavascriptClass("NM_NRD_EDITPAYMENT_WII", "nonmember-nrd-editpayment-wii.js", new JavascriptClass[]{NM_NRD_CORE, NM_NRD_WII_ERROR_LAYER, NM_NRD_WII_EXIT_LAYER, NM_NRD_OSK_BASE});
+    NM_NRD_LANDING_WII = new JavascriptClass("NM_NRD_LANDING_WII", "nonmember-nrd-landing-wii.js", new JavascriptClass[]{NM_NRD_CORE_LITE, NM_NRD_WII_ERROR_LAYER, NM_NRD_WII_EXIT_LAYER, NM_NRD_OSK_BASE});        /* just for testing, donot check in */
+    NM_NRD_LOGIN_WII = new JavascriptClass("NM_NRD_LOGIN_WII", "nonmember-nrd-login-wii.js", new JavascriptClass[]{NM_NRD_CORE_LITE, NM_NRD_WII_ERROR_LAYER, NM_NRD_WII_EXIT_LAYER, NM_NRD_OSK_BASE});
+    NM_NRD_HOME_WII = new JavascriptClass("NM_NRD_HOME_WII", "nonmember-nrd-home-wii.js", new JavascriptClass[]{NM_NRD_CORE_LITE, NM_NRD_WII_ERROR_LAYER, NM_NRD_WII_EXIT_LAYER, NM_NRD_OSK_BASE});
+    NM_NRD_ADDRESS_WII = new JavascriptClass("NM_NRD_ADDRESS_WII", "nonmember-nrd-address-wii.js", new JavascriptClass[]{NM_NRD_CORE_LITE, NM_NRD_WII_ERROR_LAYER, NM_NRD_WII_EXIT_LAYER, NM_NRD_OSK_BASE});
+    NM_NRD_ORDERFINAL_WII = new JavascriptClass("NM_NRD_ORDERFINAL_WII", "nonmember-nrd-orderfinal-wii.js", new JavascriptClass[]{NM_NRD_CORE_LITE, NM_NRD_WII_ERROR_LAYER, NM_NRD_WII_EXIT_LAYER, NM_NRD_OSK_BASE});
+    NM_NRD_PAYMENT_WII = new JavascriptClass("NM_NRD_PAYMENT_WII", "nonmember-nrd-payment-wii.js", new JavascriptClass[]{NM_NRD_CORE_LITE, NM_NRD_WII_ERROR_LAYER, NM_NRD_WII_EXIT_LAYER, NM_NRD_OSK_BASE});
+    NM_NRD_MARKETINGSCREEN_WII = new JavascriptClass("NM_NRD_MARKETINGSCREEN_WII", "nonmember-nrd-marketingscreen-wii.js", new JavascriptClass[]{NM_NRD_CORE_LITE, NM_NRD_WII_EXIT_LAYER});
+    NM_NRD_ORDERCONFIRMATION_WII = new JavascriptClass("NM_NRD_ORDERCONFIRMATION_WII", "nonmember-nrd-orderconfirmation-wii.js", new JavascriptClass[]{NM_NRD_CORE_LITE, NM_NRD_WII_ERROR_LAYER, NM_NRD_WII_EXIT_LAYER, NM_NRD_OSK_BASE});
+    NM_NRD_EDITADDRESS_WII = new JavascriptClass("NM_NRD_EDITADDRESS_WII", "nonmember-nrd-editaddress-wii.js", new JavascriptClass[]{NM_NRD_CORE_LITE, NM_NRD_WII_ERROR_LAYER, NM_NRD_WII_EXIT_LAYER, NM_NRD_OSK_BASE});
+    NM_NRD_EDITPAYMENT_WII = new JavascriptClass("NM_NRD_EDITPAYMENT_WII", "nonmember-nrd-editpayment-wii.js", new JavascriptClass[]{NM_NRD_CORE_LITE, NM_NRD_WII_ERROR_LAYER, NM_NRD_WII_EXIT_LAYER, NM_NRD_OSK_BASE});
 
     // Account Pages
     GIFT_ADDRESS = new JavascriptClass("GIFT_ADDRESS", "giftaddress.js", NO_DEPENDENCIES);
Index: ../../WebEng/monthly/javaweb/public_html/layout/css/nonmember-nrd-wii.css
===================================================================
--- ../../WebEng/monthly/javaweb/public_html/layout/css/nonmember-nrd-wii.css	(revision 37)
+++ ../../WebEng/monthly/javaweb/public_html/layout/css/nonmember-nrd-wii.css	(revision )
@@ -29,8 +29,8 @@
   padding:0;
   border:0;
   font-size:100%;
-/*  font: inherit;
-  vertical-align:baseline;  */
+  font: inherit;
+  vertical-align:baseline;
 }
 
 article, aside, details, figcaption, figure,
@@ -109,8 +109,8 @@
   -webkit-appearance:none; 
   -moz-appearance:none;
   -moz-box-sizing: border-box; /* FF1+ */
-/* -webkit-box-sizing: border-box;  *//* Saf3+ */
-/*  box-sizing: border-box; *//* Standard. Opera7+, IE8+ */;
+  -webkit-box-sizing: border-box;  /* Saf3+ */
+  box-sizing: border-box; /* Standard. Opera7+, IE8+ */;
   outline:none; /* WK */
 }
 
@@ -154,7 +154,6 @@
  * minimal base styles
  */
 body, select, input, textarea {
-  /*-webkit-font-smoothing: antialiased;*/
   -webkit-user-select: none;
   -moz-user-select: none;
  /* #444 looks better than black: twitter.com/H_FJ/statuses/11800719859 */
@@ -430,6 +429,9 @@
  */
 header.main {
   background-color:#8d0303;
+  -moz-box-sizing: border-box;
+  -webkit-box-sizing:border-box;
+  box-sizing:border-box;
 }
 
 header.main .logo {
@@ -437,6 +439,9 @@
   margin:0 auto;
   max-width: 640px;
   padding:0 5%;
+  -moz-box-sizing: border-box;
+  -webkit-box-sizing:border-box;
+  box-sizing:border-box;
 }
 
 header.main .logo img {
@@ -448,14 +453,13 @@
 .main-content {
   /* stroke/border didn't work well for bowser, dropping it */
   background-color: rgba(191, 191, 191, 0.9);
-
-/*  -moz-box-sizing: border-box; */ /*FF1+ */
-/*  -webkit-box-sizing: border-box; *//* Saf3+ */
-/*  box-sizing: border-box;*/ /* Standard. Opera7+, IE8+ */
+  -moz-box-sizing: border-box; /* FF1+ */
+  -webkit-box-sizing: border-box; /* Saf3+ */
+  box-sizing: border-box; /* Standard. Opera7+, IE8+ */
   max-width:640px;
   margin:0 auto;
- /* -moz-box-shadow: 3px 3px 10px 3px rgba(0,0,0,0.5);  FF3.5+ */
- /* -webkit-box-shadow: 3px 3px 10px 3px rgba(0,0,0,0.5);  Saf3+, Chrome */
+  -moz-box-shadow: 3px 3px 10px 3px rgba(0,0,0,0.5); /* FF3.5+ */
+  -webkit-box-shadow: 3px 3px 10px 3px rgba(0,0,0,0.5); /* Saf3+, Chrome */
 }
 
 .wii-body,
@@ -463,10 +467,9 @@
   padding:0 5%; /* both the body and buttons need a left/right padding of 5% */
   margin: 0 auto;
   max-width:640px;
-    /*
   -moz-box-sizing: border-box;
   -webkit-box-sizing:border-box;
-  box-sizing:border-box;*/
+  box-sizing:border-box;
 }
 .wii-body {
   height:300px;
@@ -910,15 +913,14 @@
 
 
 .waitstate span {
-    padding-top:20px;
-    vertical-align:bottom;
+  padding-top:20px;
+  vertical-align:bottom;
 }
 
 .smokeglass {
   width:100%;
   height: 100%;
   background-color: rgba(30,30,30,.8);
-  opacity:0.8;
   display: block;
   left: 0px;
   top: 0px;
@@ -1233,57 +1235,69 @@
 * Osk Layer CSS
 */
 
-.osk {
+.osk-keys-container {
-    display:table;
-    border-spacing:4px 0;
-    position:relative; /* make the cell the containing block */
+  display:table;
+  border-spacing:4px 0;
+  position:relative; /* make the cell the containing block */
+  z-index:1009;
 }
 
-.osk-view {
-    display:none;
-}
-
+/* .osk_container */
 .oskLayer {
+  /*
-    border:none;
-    display: none;
-    font-size: 16px;
-    position:absolute;
-    background:  rgb(168,165,158);
-    z-index:1010;
-    color:black;
-    top:50px;
-    padding:0 8px 10px 10px;
+  border:none;
+  display: none;
+  font-size: 16px;
+  position:absolute;
+  background:  rgb(168,165,158);
+  z-index:1010;
+  color:black;
+  top:50px;
+  padding:0 8px 10px 10px;
+  */
     
+  position: absolute;
+  top: 150px;
+  left: 60px;
+  padding: 10px;
+  background-color: rgba(221,221,221,0.7);
+  z-index:1010;  
 }
+
 .osk-row {
-    margin-bottom:4px;
+  margin-bottom:4px;
 }
 
 
 .osk-cell {
-    display:table-cell;
-  	vertical-align:middle;
-  	text-align:center;
-    width:46px;
-	height:46px;
+  display:table-cell;
+  vertical-align:middle;
+  text-align:center;
+  width:46px; 
+  height:46px;
-	border:none;
-    margin:0 auto;
-    background:rgb(223,223,223);
+  border:1px #000 solid;
+  -webkit-box-sizing:border-box;
+  box-sizing:border-box;
+  margin:4px;
+  background-color:#fff;
 }
 
 .osk-cell-highlight {
-	position:absolute;
+  position:absolute;
-	background: rgba(255, 165, 0, 0.8);
+  background:rgba(255, 165, 0, 0.8);
-    visibility:hidden;    
+  visibility:hidden;
-    z-index:0;
+  border:1px #000 solid;
+  z-index:-1;
 }
 
 .osk-cell.double {
-    width:96px;
+  width:96px; 
 }
 
+
+
 .osk-cell.quad {
-	width:196px;
+    width:196px;
 }
 
 .osk-cell.date {
@@ -1303,20 +1317,27 @@
     background:rgb(102,102,102);
 }
 
-.osk-cell span + span {
-    display:none;
-    visibility:hidden;
-}
-
-
-.oskLayer header input{
+.oskLayer header input {
-    width:98%;
+  outline:none; /* WK */
+  display:block;
+  width:100%;
+  margin: 0;
+  -moz-box-sizing: border-box; /* FF1+ */
+  -webkit-box-sizing: border-box; /* Saf3+ */
+  box-sizing: border-box; /* Standard. Opera7+, IE8+ */
+  background-color:#dfdfdf;
-    font-size:16px;
+  font-size:16px;
+  padding:4px;
+  border:4px solid #dcdcdc;
+  color:#4d4a4a;
-    height:30px;
+  height:30px;    
-    background:rgb(223,223,223);
-    border:4px solid #DCDCDC;
 }
 
+.oskLayer header input.focus {
+  border:4px solid #ea9517;
+  background-color:#625d5b;
+  color:#a4a3a3;
+}
 
 .oskLayer header img {
     border:0;
